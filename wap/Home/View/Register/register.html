<html style="font-size: 62.4px;">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui">
<meta name="screen-orientation" content="portrait">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<meta name="full-screen" content="yes">
<meta name="x5-fullscreen" content="true">
<meta name="viewport" content="width=device-width,user-scalable=no">
<meta name="keywords" content="<?php echo $_SESSION['sc']['infor']['keywords']?>"/>
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>"/>
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" /> 
<title>方大商城</title>
<link href="__PUBLIC__/Wap/css/login/app.css?v.1" rel="stylesheet">
</head>
<body>
<div id="app">
  <div class="l_register">
    <div class="l_register_title">
      <div >
        <div  class="title">
          <a href="javascript:window.history.back();" class="tit_icon left">
            <i  class="iconfont icon-arrow-left"></i> 
          </a> 
          <div  class="tit_font"></div> 
        </div>
      </div> 
      <div class="yl_img">
        <div class="yl_img_bg"><img src="/<?php echo $_SESSION['sc']['infor']['logo']?>" alt=""></div> 
        <p>注册成为方大商城用户</p>
      </div>
    </div> 
    <div class="yl_mode_list">
    <div class="yl_mode_item l_register_item">
        <div class="yl_icon">昵称</i>
        </div> 
        <input type="text" placeholder="请输入昵称" name="uname" id="uname" maxlength="11"> 
      </div> 
      <div class="yl_mode_item l_register_item">
        <div class="yl_icon">手机号</div> 
        <input type="text" placeholder="请输入手机号" id="mobile" name="mobile" maxlength="11">
      </div> 
      <div class="yl_mode_item l_register_item">
        <div class="yl_icon">登录密码</i>
        </div> 
        <input type="password" placeholder="密码8到20位，至少包含字母和数字" name="password" maxlength="20" id="password"> 
      </div> 
      <div class="yl_mode_item l_register_item">
        <div class="yl_icon">确认密码</i>
        </div> 
        <input type="password" placeholder="密码8到20位，至少包含字母和数字" name="respassword" maxlength="20" id="respassword"> 
      </div> 
      <div class="yl_mode_item l_register_item">
        <div class="yl_icon">支付密码</div> 
        <input placeholder="请输入6位数字密码" type="password" name="paypass" id="paypass" maxlength="6"> 
      </div> 
      <div class="yl_mode_item l_register_item">
        <div class="yl_icon">确认密码</div> 
        <input placeholder="请输入6位数字密码" type="password" name="respaypass" id="respaypass" maxlength="6"> 
      </div> 
      <div class="yl_mode_item l_register_item">
        <div class="yl_icon">短信验证</div> 
        <input placeholder="验证码" type="text" id="smsCode" maxlength="4"> 
        <div class="yl_icon l_register_icon"><a href="javascript:sendUserCode();" class="ygqq_login_dx_a ygqq_register_dx_a">发送短信</a></div>
      </div>
    </div> 
    <div class="mlr30">
      <a class="btn_block" onclick="doRegister()">立即注册</a>
    </div> 
  </div>
</div>
<script type="text/javascript" src="__PUBLIC__/Wap/js/jquery.min.js"></script>
<script src="__PUBLIC__/Wap/js/layer/layer.js"></script>
</body>
<script>
//注册获取验证码
function sendUserCode(){
  var mobile = $("#mobile").val();
  var isMobile = /^0?1[3-8][0-9]\d{8}$/; // 手机号码验证规则
  if (mobile == "请输入手机号" || mobile == "" || mobile == null) {
    layer.open({
        content: '请输入手机号！'
        ,skin: 'msg'
        ,time: 2 //2秒后自动关闭
    });
    $("#mobile").focus();
    return false;
  } else if (!isMobile.test(mobile)) {
    layer.open({
        content: '手机号格式不正确！'
        ,skin: 'msg'
        ,time: 2 //2秒后自动关闭
    });
    $("#mobile").focus();
    return false;
  } else{
    checkValidCode();
  }
}
/*发送验证码*/
function checkValidCode(){
  var mobile = $("#mobile").val();
  var time=120;
  var url = "<{:U('Register/checkValidCode')}>";
  $.ajax({
    type: "post",
    url: url,
    async: false,
    data:{mobile :mobile},
    error: function() {
      layer.open({
          content: '网络故障，请稍后重试!'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
    },
    success:function(data){
      if(data.infor == 2){
         $(".ygqq_register_dx_a").attr("href","#");
          var t=setInterval(function  () {
          time--;
               $(".ygqq_register_dx_a").html(time+"秒");
              if (time==0) {
                  clearInterval(t);
                  $(".ygqq_register_dx_a").attr("href","javascript:updateMobileOldVerifyCode();");
                   $(".ygqq_register_dx_a").html("重新发送");
              }
          },1000) 
      }else if(data.infor == 3){
        layer.open({
            content: '验证码发送失败，请从新发送！'
            ,skin: 'msg'
            ,time: 2 //2秒后自动关闭
        });
      }else if(data.infor == 4){
        layer.open({
            content: '手机号已存在，请填写新的手机号！'
            ,skin: 'msg'
            ,time: 2 //2秒后自动关闭
        });
      }
    }
  });
}
/*检查手机号*/
$("#mobile").blur(function(){
  var mobile = $("#mobile").val();
  var isMobile = /^0?1[3-8][0-9]\d{8}$/; // 手机号码验证规则
  if (!isMobile.test(mobile)) {
    layer.open({
        content: '手机号格式不正确！'
        ,skin: 'msg'
        ,time: 2 //2秒后自动关闭
    });
    return false;
  }
})
/*检查密码*/
$("#password").blur(function(){
  var password = $("#password").val();
  if (!/(?!^(\d+|[a-zA-Z]+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]{8,20}$/.test(password)) {
    layer.open({
        content: '密码格式不正确！'
        ,skin: 'msg'
        ,time: 2 //2秒后自动关闭
    });
    return false;
  }
})
$("#respassword").blur(function(){
  var password = $("#password").val();
  var respassword = $("#respassword").val();
  if(password != respassword){
    layer.open({
        content: '两次登录密码不一致！'
        ,skin: 'msg'
        ,time: 2 //2秒后自动关闭
    });
    return false;
  }
})
$("#respaypass").blur(function(){
  var paypass = $("#paypass").val();
  var respaypass = $("#respaypass").val();
  if(paypass != respaypass){
    VerifyFailed('respaypass','两次支付密码不一致！');
    return false;
  }
})
function doRegister(){
    var mobile = $("#mobile").val();
    var uname = $("#uname").val();
    var password = $("#password").val();
    var respassword = $("#respassword").val();
    var paypass = $("#paypass").val();
    var respaypass = $("#respaypass").val();
    if(mobile == '' || mobile == null || mobile == undefined){
      layer.open({
          content: '请输入手机号！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(uname == '' || uname == null || uname == undefined){
      layer.open({
          content: '请输入昵称！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(password == '' || password == null || password == undefined){
      layer.open({
          content: '请输入密码！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if (!/(?!^(\d+|[a-zA-Z]+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]{8,20}$/.test(password)) {
      layer.open({
          content: '密码格式不正确！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(respassword == '' || respassword == null || respassword == undefined){
      layer.open({
          content: '请输入确认密码！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(password != respassword){
      layer.open({
          content: '两次登录密码不一致！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(paypass == '' || paypass == null || paypass == undefined){
      layer.open({
          content: '请输入支付密码！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(!/^[0-9]*$/.test(paypass)){
       layer.open({
          content: '支付密码格式不正确！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(respaypass == '' || respaypass == null || respaypass == undefined){
      layer.open({
          content: '请输入确认支付密码！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if(paypass != respaypass){
      layer.open({
          content: '两次支付密码不一致！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      return false;
    }
    if($('#smsCode').val()=="" || $('#smsCode').val()=="请输入短信验证码"){
      layer.open({
          content: '请填写短信验证码！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      $("#smsCode").focus();
      return false;
    }
    if(!/^[0-9]*$/.test($('#smsCode').val())){
      layer.open({
          content: '短信验证码格式不正确！'
          ,skin: 'msg'
          ,time: 2 //2秒后自动关闭
      });
      $("#smsCode").focus();
      return false;
    }
    var url = "<{:U('Register/doRegisterForMobile')}>";
    $.ajax({
      type: "post",
      url: url,
      dataType:'json',
      async: false,
      data:{
        mobile :$("#mobile").val(),
        password :password,
        respassword:respassword,
        code:$('#smsCode').val(),
        uname:$('#uname').val(),
        paypass:paypass,
        respaypass:respaypass
        },
      success:function(data){
        if(data.status == 'true'){
          window.location.href = "<{:U('User/member')}>";
        }else if(data.status == 'false'){
          layer.open({
              content: data.msg
              ,skin: 'msg'
              ,time: 2 //2秒后自动关闭
          });
        }
      }
    });
}
</script>
</html>
