<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="keywords" content="<?php echo $_SESSION['sc']['infor']['keywords']?>">
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>">
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" /> 
<link rel="stylesheet" href="__PUBLIC__/Wap/css/base.css">
<link rel="stylesheet" href="__PUBLIC__/Wap/css/anquan/login_password.css">
<title>实名认证</title>
</head>
<body>
	<header>
		<a href="javascript:window.history.back();"><img src="__PUBLIC__/Wap/images/anquan/come_back.png" alt=""></a>
		<h3>实名认证</h3>
	</header>
	<form action="">
		<ul>
			<li>
				<h3>真实姓名</h3>
				<?php if($info['usta'] == 2){?>
                  <?php 
                    $uname= substr($info['uname'],3);
                    $len=strlen($info['uname']);
                    if($len == 6){
                      $zifu='*';
                    }else if($len == 9){
                      $zifu='**';
                    }else{
                      $zifu='***';
                    }
                    $username= str_replace($uname,$zifu,$info['uname']);
                    $subcard= substr($info['ucode'],4,-4);
                    $usercard= str_replace($subcard,'******',$info['ucode']);
                  ?>
                  <input  type="text" readonly="" value="<{$username}>"/>
                <?php }else{ ?>
                  <input type="text" placeholder="请输入真实姓名" id="realname" maxlength="4">
                <?php } ?>
			</li>
			<li class="no_border">
				<h3>身份证号</h3>
				<?php if($info['usta'] == 2){?>
                  <input type="text" value="<{$usercard}>" readonly=""/>
                <?php }else{?>
                  <input type="text" placeholder="请输入身份证号" id="idcard" maxlength="18">
                <?php }?>
			</li>
			<?php if($info['usta'] == 3){?>
			<li>
				<button type="button" id="updateAuthentication">确定</button>
			</li>
			<?php }?>
		</ul>
	</form>
</body>
<script type="text/javascript" src="__PUBLIC__/Wap/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Wap/js/base.js"></script>
<script src="__PUBLIC__/Wap/js/layer/layer.js"></script>
<script>
//设置 实名认证
$("#updateAuthentication").click(function () {
    var a = $("#realname").val();
    var b = $("#idcard").val();
    var c = /[\u4E00-\u9FA5]{2,5}(?:\u00b7[\u4E00-\u9FA5]{2,5})*/;
    var url = "<{:U('User/idCardAuth')}>";
    if(a == ''){
    	layer.open({
	        content: '请填写真实姓名！'
	        ,skin: 'msg'
	        ,time: 2 //2秒后自动关闭
	    });
	    return false;
    }else if(!c.test(a)){
    	layer.open({
	        content: '姓名格式不正确！'
	        ,skin: 'msg'
	        ,time: 2 //2秒后自动关闭
	    });
	    return false;
    }else if(b == ''){
    	layer.open({
	        content: '请填写身份证号！'
	        ,skin: 'msg'
	        ,time: 2 //2秒后自动关闭
	    });
	    return false;
    }else if(!regularCheckCardNo(b)){
    	layer.open({
	        content: '身份证号格式不正确！'
	        ,skin: 'msg'
	        ,time: 2 //2秒后自动关闭
	    });
	    return false;
    }
    $.ajax({
        type: "post",
        url: url,
        dataType: "json",
        data: {
            realname: a,
            idcard: b
        },
        success: function (a) {		
	        if(a == 2){
	          window.location.reload();
	        }else{
	          	layer.open({
			        content: '设置失败！'
			        ,skin: 'msg'
			        ,time: 2 //2秒后自动关闭
			    });
			    return false;
	        }
	    }
	})
});
function regularCheckCardNo(a) {
    var b = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2, 1],
        c = "10X98765432".split(""),
        d = [],
        e = 0,
        g = a.length;
    if (18 != g) return !1;
    for (var f = 0; f < g; f++) {
        d[f] = a.charAt(f);
        if (("0" > d[f] || "9" < d[f]) && 17 != f) return !1;
        17 > f && (d[f] *= b[f])
    }
    if (18 == g) {
        a = a.substring(6, 14);
        if (0 == isDate8(a)) return !1;
        for (f = 0; 17 > f; f++) e += d[f];
        c = c[e % 11];
        if (d[17] != c) return !1
    } else if (d = a.substring(6, 12), 0 == isDate6(d)) return !1;
    return !0
}

function isDate8(a) {
    if (!/^[0-9]{8}$/.test(a)) return !1;
    var b, c;
    b = a.substring(0, 4);
    c = a.substring(4, 6);
    a = a.substring(6, 8);
    var d = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    if (1700 > b || 2500 < b) return !1;
    if (0 == b % 4 && 0 != b % 100 || 0 == b % 400) d[1] = 29;
    return 1 > c || 12 < c || 1 > a || a > d[c - 1] ? !1 : !0
}
</script>
</html>