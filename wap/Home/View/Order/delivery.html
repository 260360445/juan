<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="keywords" content="<?php echo $_SESSION['sc']['infor']['keywords']?>">
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>">
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" /> 
<link rel="stylesheet" href="__PUBLIC__/Wap/css/base.css">
<link rel="stylesheet" href="__PUBLIC__/Wap/css/order/shipments.css">
<title>订单详情-待收货</title>
</head>
<body>
	<header>
		<a href="javascript:window.history.back();"><img src="__PUBLIC__/Wap/images/order/come_back.png" alt=""></a>
		<h3>订单详情</h3>
	</header>
	<div class="shipments_top">
		<img src="__PUBLIC__/Wap/images/order/shangpu.png" alt="">
		<p>订单号：<i><{$info['order_num']}></i></p>
		<span>待收货</span>
	</div>
	<!-- <div class="shipments_address wuliu">
		<a href="#">
			<img src="__PUBLIC__/Wap/images/order/huoche.png" alt="">
			<h3>快件已签收，确认本人签收</h3>
			<p>2016.10.20 上午9:30</p>
			<span>
				<img src="__PUBLIC__/Wap/images/order/more.png" alt="">
			</span>
		</a>
	</div> -->
	<div class="shipments_address">
		<img src="__PUBLIC__/Wap/images/order/dingwei.png" alt="">
		<h3><{$address['name']}><span><{$address['mobile']}></span></h3>
		<p><{$address['province']}><{$address['city']}><{$address['area']}><{$address['street']}></p>
	</div>
	<div class="shipments_center">
		<img src="__ROOT__/Uploads<{$info.goods_logo}>" alt="">
		<h3><{$info['goods_title']}></h3>
		<p>可用金：￥<i><{$info.price}></i></p>
		<p>消费币：￥<i><{$info.xfb}></i></p>
		<span>×<i><{$info.buynum}></i></span>
	</div>
	<div class="shipments_bottom">
		<h4>总计：<i>￥<{$info.sumpay}></i></h4>
		<h3>共<span><{$info.buynum}></span>件商品</h3>
	</div>
	<div class="order_for_goods">
		<h3>订单信息</h3>
		<ul>
			<li>下单时间：<span><{:date('Y-m-d H:i:s',$info['buytime'])}></span> </li>
			<li>付款时间：<span><{:date('Y-m-d H:i:s',$info['pay_time'])}></span></li>
			<li>发货时间：<span><{:date('Y-m-d H:i:s',$express['express_time'])}></span></li>
		</ul>
		<h4>实付款：<span>￥<i><{$info.sumpay}></i></span></h4>
	</div>
	<footer>
		<a href="javascript:void(0);" id="pay">确认收货</a>
	</footer>
	<div class="mask">
		<div class="pay_password">
			<h3>支付密码</h3>
			<!-- 支付密码开始 -->
		    <div class="alieditContainer" id="payPassword_container">
                <input minlength="6" maxlength="6" tabindex="1" id="payPassword_rsainput" name="payPassword_rsainput" class="ui-input i-text" oncontextmenu="return false" onpaste="return false" oncopy="return false" oncut="return false" autocomplete="off"  type="password" >
                <div class="sixDigitPassword" tabindex="0">
                    <i class="active"><b></b></i>
                    <i><b></b></i>
                    <i><b></b></i>
                    <i><b></b></i>
                    <i><b></b></i>
                    <i><b></b></i>
                </div>
            </div>
            <!-- 支付密码结束 -->
			<button type="button" id="dopay">付款</button>
			<em></em>
		</div>
	</div>
</body>
<script type="text/javascript" src="__PUBLIC__/Wap/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Wap/js/base.js"></script>
<script src="__PUBLIC__/Wap/js/layer/layer.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
	// 点击显示 .mask
	$('#pay').click(function(){
		$('.mask').show();
		$('.mask .pay_password').show();
		$('.i-text').focus(); //先让 input 自动获得焦点
	})
	$('.mask .pay_password button').click(function(){
		$('.mask .pay_success').show();
	})
	$('.mask em').click(function(){
		$('.mask').hide();
	})
	// 支付密码
    $(".i-text").keyup(function() {
        var inp_v = $(this).val();
        var inp_l = inp_v.length;
        for (var x = 0; x <= 6; x++) {
            $(".sixDigitPassword").find("i").eq(inp_l).addClass("active").siblings("i").removeClass("active");
            $(".sixDigitPassword").find("i").eq(inp_l).prevAll("i").find("b").css({ "display": "block" });
            $(".sixDigitPassword").find("i").eq(inp_l - 1).nextAll("i").find("b").css({ "display": "none" });

            $(".guangbiao").css({ "left": inp_l * 31 }); //光标位置

            if (inp_l == 0) {
                $(".sixDigitPassword").find("i").eq(0).addClass("active").siblings("i").removeClass("active");
                $(".sixDigitPassword").find("b").css({ "display": "none" });
                $(".guangbiao").css({ "left": 0 });
            } else if (inp_l == 6) {
                $(".sixDigitPassword").find("b").css({ "display": "block" });
                $(".sixDigitPassword").find("i").eq(5).addClass("active").siblings("i").removeClass("active");
                $(".guangbiao").css({ "left": 5 * 31 });
            }
        }
    });
})
//确认收货
$("#dopay").click(function() {
    var url = "<{:U('Order/setOrder')}>";
    var flg = <?php echo $info['order_id']?>;
    var pass = $("#payPassword_rsainput").val();
    var tel = /^[0-9]*$/;
    if (pass == '' || pass == null) {
        layer.open({
            content: '请输入支付密码！'
            ,skin: 'msg'
            ,time: 2 //2秒后自动关闭
        });
        return false;
    } else if (!tel.test(pass)) {
        layer.open({
            content: '请输入6位数字支付密码！'
            ,skin: 'msg'
            ,time: 2 //2秒后自动关闭
        });
        return false;
    }
    var index =  layer.open({
        type: 2
        ,content: '付款中...'
    });
    $.ajax({
        type: 'post',
        url: url,
        data: { buy: flg, pass: pass },
        dataType: 'json',
        error: function() {
	        layer.open({
                content: '网络故障，请稍后重试!'
                ,skin: 'msg'
                ,time: 2 //2秒后自动关闭
            });
            setTimeout(function () { test(); }, 2005);
            return false;
        },
        success: function(responses) {
            if (responses.msg == 'ok') {
	            layer.open({
	                content:'付款成功，货款会直接付给商家!'
	                ,skin: 'msg'
	                ,time: 2 //2秒后自动关闭
	            });
	            setTimeout(function () { shouhuo(); }, 2005);
	            return false;
            } else {
                layer.open({
	                content: responses.msg
	                ,skin: 'msg'
	                ,time: 2 //2秒后自动关闭
	            });
	            setTimeout(function () { test(); }, 2005);
	            return false;
            }
        }
    });
})
function test(){
    window.location.reload();
}
function shouhuo(){
     window.location.href = "<{:U('Order/shouhuo')}>";
}
</script>
</html>