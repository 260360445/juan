<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="keywords" content="<?php echo $_SESSION['sc']['infor']['keywords']?>">
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>">
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" />
<link rel="stylesheet" href="__PUBLIC__/Wap/css/base.css">
<link rel="stylesheet" href="__PUBLIC__/Wap/css/order/shipments.css">
<title>写评价</title>
</head>
<style type="text/css">
body {
    padding-bottom: 1.7rem;
}

.content {
    background-color: #fff;
}

.content div {
    overflow: hidden;
    border-top: 1px solid #ededed;
    border-bottom: 1px solid #ededed;
    padding: .46rem .5rem 0 .5rem;
}

.content div img {
    float: left;
    display: block;
    width: 2rem;
    height: 2rem;
}

.content div textarea {
    float: left;
    border: 0;
    margin: 0 0 .3rem .333rem;
    resize: none;
    outline: none;
}

.content button {
    display: block;
    width: 100%;
    text-align: center;
    height: 1.466rem;
    line-height: 1.466rem;
    font-size: .4rem;
    color: #b3b3b3;
    background-color: #fff;
    background: url(/Public/Wap/images/order/camera.png) no-repeat 4rem .45rem;
    -webkit-background-size: .633rem .5rem;
    background-size: .633rem .5rem;
}

footer {
    width: 100%;
    position: fixed;
    bottom: 0;
    left: 0;
    border-top: 1px solid #e6e6e6;
}

footer button {
    width: 100%;
    color: #ff1b2f;
    font-size: .466rem;
    background-color: #fff;
    text-align: center;
    line-height: 1.7rem;
}

.container {
    width: 100%;
    height: 100%;
    overflow: auto;
    clear: both;
}

.z_photo {
    padding: .5rem;
    overflow: auto;
    clear: both;
    margin: 0 auto;
}

.z_photo img {
    width: 2rem;
    height: 2rem;
    float: left;
}

.z_addImg input {
    position: absolute;
    z-index: -999;
}

.z_addImg {
    float: left;
    margin-right: 0.2rem;
}

.z_file {
    width: 2rem;
    height: 2rem;
    background: url(/Public/Wap/images/z_add.png) no-repeat;
    background-size: 100% 100%;
    margin-right: 0.2rem;
    float: left;
}

.z_file input::-webkit-file-upload-button {
    width: 2rem;
    height: 2rem;
    border: none;
    position: absolute;
    outline: 0;
    opacity: 0;
}

.z_file input#file {
    display: block;
    width: auto;
    border: 0;
    vertical-align: middle;
}



/*遮罩层*/

.z_mask {
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, .5);
    position: fixed;
    top: 0;
    left: 0;
    z-index: 999;
    display: none;
}

.z_alert {
    width: 3rem;
    height: 2rem;
    border-radius: .2rem;
    background: #fff;
    font-size: .24rem;
    text-align: center;
    position: absolute;
    left: 50%;
    top: 50%;
    margin-left: -1.5rem;
    margin-top: -2rem;
}

.z_alert p:nth-child(1) {
    line-height: 1.5rem;
}

.z_alert p:nth-child(2) span {
    display: inline-block;
    width: 49%;
    height: .5rem;
    line-height: .5rem;
    float: left;
    border-top: 1px solid #ddd;
}

.z_cancel {
    border-right: 1px solid #ddd;
}

.imgbox ul {
    overflow: hidden;
    padding-top: 30px;
}

.imgbox li {
    float: left;
    display: none;
    position: relative;
    width: 2rem;
    height: 2rem;
    margin: 0 .2rem;
}

.imgbox li input {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    opacity: 0;
    z-index: 99;
}

.imgbox li img {
    width: 100%;
    height: 100%;
}

.imgbox li img.upimg {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
}

.imgbox li:first-child {
    display: block;
}

.imgbox li i {
    position: absolute;
    width: 20px;
    height: 20px;
    top: -10px;
    right: -10px;
    text-align: center;
    font-size: 16px;
    line-height: 20px;
    background: #ccc;
    z-index: 99999999;
    border-radius: 50%;
}

.pingjia div .buttons {
    margin: 20px 0px 0px 350px;
    display: block;
    width: 68px;
    height: 28px;
    background-color: #c40000;
    color: #fff;
    font-size: 14px;
    line-height: 28px;
    border: 0;
    outline: none;
    border-radius: 2px;
    text-align: center;
    cursor: pointer;
}
</style>

<body>
    <header>
        <a href="javascript:window.history.back();"><img src="__PUBLIC__/Wap/images/order/come_back.png" alt=""></a>
        <h3>写评价</h3>
    </header>
    <form id="fbg">
    <div class="content">
        <div>
            <img src="__ROOT__/Uploads<{$goods['goods_logo']}>" alt="">
            <input type="hidden" name="gid" value="<?php echo $_GET['gid']?>">
            <textarea name="cont" id="cont" cols="30" rows="4" placeholder="快来点评一下商品吧~"></textarea>
            <button>发布图片</button>
        </div>
    </div>
    <div class="imgbox" style="width: 680px;">
        <ul>
            <li>
                <input class="uploading" type="file" name="showlogo1">
                <img class="upimg" src="/Public/Wap/images/z_add.png" alt="" />
            </li>
            <li>
                <input class="uploading" type="file" name="showlogo2">
                <img class="upimg" src="/Public/Wap/images/z_add.png" alt="" />
            </li>
            <li>
                <input class="uploading" type="file" name="showlogo3">
                <img class="upimg" src="/Public/Wap/images/z_add.png" alt="" />
            </li>
            <li>
                <input class="uploading" type="file" name="showlogo4">
                <img class="upimg" src="/Public/Wap/images/z_add.png" alt="" />
            </li>
            <li>
                <input class="uploading" type="file" name="showlogo5">
                <img class="upimg" src="/Public/Wap/images/z_add.png" alt="" />
            </li>
        </ul>
    </div>
    <footer>
        <button type="button" onclick="setcom()">发表评价</button>
    </footer>
    </form>
</body>
<script type="text/javascript" src="__PUBLIC__/Wap/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Wap/js/base.js"></script>
<script src="__PUBLIC__/Wap/js/layer/layer.js"></script>
<script type="text/javascript">
$(function() {
    function getObjectURL(file) {
        var url = null;
        if (window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        } else if (window.URL != undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }
    $(".imgbox").on('change', 'ul li .uploading', function() {
        var objUrl = getObjectURL(this.files[0]);
        if (objUrl) {
            $(this).siblings('.upimg').css('display', 'none').parent().append('<img src="' + objUrl + '"/><i class="remove">×</i>');
            $(this).parent().next().css('display', 'block')
            return false;
        }
    })
    $(".imgbox").on('click', 'ul li .remove', function() {
        $('.imgbox ul').append('<li><input class="uploading" type="file" name="' + $(this).siblings('input').attr('name') + '"><img class="upimg" src="__PUBLIC__/Home/static/new/img/icon/uploading.png" /></li>');
        if ($('.imgbox ul li i').length == 5) {
            $('.imgbox ul li:last').css('display', 'block')
        }
        $(this).parent().remove();
    })
})

function setcom() {
    var cont = $("#cont").val();
    var url = "<{:U('User/setcom')}>";
    var fbg = new FormData($('#fbg')[0]);
    if (cont == '') {
        layer.open({
            content: '请写下您的评价!',
            skin: 'msg',
            time: 2 //2秒后自动关闭
        });
        return false;
    }
    var index = layer.open({
        type: 2,
        content: '提交中...'
    });
    $.ajax({
        type: 'post',
        url: url,
        data: fbg,
        async: false,
        processData: false,
        contentType: false,
        error: function() {
             layer.open({
                content: '网络故障，请稍后重试!',
                skin: 'msg',
                time: 2 //2秒后自动关闭
            });
            return false;
        },
        success: function(responses) {
            if (responses == 'ok') {
                layer.open({
                    content: '发布成功',
                    skin: 'msg',
                    time: 2 //2秒后自动关闭
                });
                setTimeout(function() { test(); }, 2005);
                return false;
            } else {
                layer.open({
                    content: responses,
                    skin: 'msg',
                    time: 2 //2秒后自动关闭
                });
                setTimeout(function() { tests(); }, 2005);
                return false;
            }
        }
    });
}
function tests() {
    window.location.reload();
}
function test() {
    window.location.href = "<{:U('Order/pingjia')}>";
}
</script>

</html>