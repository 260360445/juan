var icon = "one two three four five six seven eight".split(" "),
    goods_detail_url = "/goods/goods",
    pageCount = 0,
    page = 0,
    bd_brand = "",
    bd_class1 = "",
    bd_class2 = "",
    speedCid;
$(function () {
    $(".w_specific_class ul").delegate("li a", "click", function (a) {
        a = a || window.event;
        a = a.target || a.srcElement;
        $(a).index(".w_specific_class ul li a");
        $(".w_specific_class ul li a").removeClass("w_effect");
        $(".w_specific_class1 ul li a").removeClass("w_effect");
        $(a).addClass("w_effect");
        //getAllBrand($(a).attr("data-id"));
        //getGoods(1);
    });
    $(".w_specific_class1 ul").delegate("li a", "click", function (a) {
        a = a || window.event;
        a = a.target || a.srcElement;
        $(a).index(".w_specific_class1 ul li a");
        $(".w_specific_class1 ul li a").removeClass("w_effect");
        $(a).addClass("w_effect");
        //getGoods(1);
    });
    $(".w_new").delegate("dd a", "click", function () {
        $(this).index(".w_new dd a");
        $(".w_new dd a").removeClass("w_announced");
        $(this).addClass("w_announced");
        if ("w_last w_announced" == $(this).attr("class")) switch ($(this).attr("data-id")) {
        case "totalPrice_down":
            $(this).attr("data-id", "totalPrice_up");
            $(this).find("img").eq(0).attr({
                src: "../static/img/front/goods/jia_01.png"
            });
            $(this).find("img").eq(1).attr({
                src: "../static/img/front/goods/jia.png"
            });
            break;
        case "totalPrice_up":
            $(this).attr("data-id", "totalPrice_down"), $(this).find("img").eq(0).attr({
                src: "../static/img/front/goods/jia_01.png"
            }), $(this).find("img").eq(1).attr({
                src: "../static/img/front/goods/jia.png"
            })
        } else $(".w_last").find("img").eq(0).attr({
            src: "../static/img/front/goods/jia_03.png"
        }), $(".w_last").find("img").eq(1).attr({
            src: "../static/img/front/goods/jia_06.png"
        });
        getGoods(1)
    });
    $(".w_specific_class1 ul").delegate(".w_right_more", "click", function () {
        $(".w_recharge_more").show();
        $(".w_right_more").hide();
        $(".w_left_more").show()
    });
    $(".w_specific_class1 ul").delegate(".w_left_more", "click", function () {
        $(".w_recharge_more").hide();
        $(".w_left_more").hide();
        $(".w_right_more").show()
    })
});

function getCategoryOne() {
    ajaxGetCategoryOne(bindCategoryOne)
}

function getAllBrand(a) {
    ajaxGetAllBrand({
        id: a
    }, bindAllBrand)
}

function getCategory(a) {
    ajaxCategoryById(a, bindCategory)
}

function getGoodsList(a) {
    ajaxGoodsListTopGoods(a, bindGoodsList)
}

function getGoodsCount() {
    var a = {
        baoyuan: $(".bao_yuan").attr("data-id")
    };
    ajaxGoodsListTopGoods(a, bindGoodsCount)
}

function bindGoodsCount(a) {
    a.status && $(".w_goods_nav h2 a").html(a.goods.total)
}

function bindGoodsList(a, d) {
    if (a.status) {
        $(".w_goods_nav h2 a").html(a.goods ? a.goods.total : 0);
        var b = [],
            e = 0;
        a.goods && $(a.goods.dataList).each(function (a, c) {
            var d = goods_detail_url + c.gid + "-" + c.pno + ".html";
            0 === a % 4 && b.push('\x3cul class\x3d"w_goods_one"\x3e');
            b.push('\x3cli class\x3d"w_goods_details ');
            3 === a % 4 && b.push("w_special");
            b.push('"\x3e\x3cdiv class\x3d"w_imgOut" data-gid\x3d"' + c.gid + '" data-pid\x3d"' + c.pno + '"\x3e\x3ca data-gid\x3d"' + c.gid + '" data-pid\x3d"' + c.pno + '" target\x3d"_blank"  class\x3d"w_goods_img" href\x3d"' + d + '" \x3e');
            b.push('\x3cimg id\x3d"img_' + e + '" data-gid\x3d"' + c.gid + '" data-pid\x3d"' + c.pno + '" class\x3d"lazy' + page + '" data-original\x3d"' + imageGoodsPath + c.showImages.split(",")[0] + imgsize + '" /\x3e\x3cnoscript\x3e\x3cimg src\x3d"' + imageGoodsPath + c.showImages.split(",")[0] + imgsize + '" alt\x3d""/\x3e\x3c/noscript\x3e\x3c/a\x3e\x3c/div\x3e');
            b.push('\x3ca class\x3d"w_goods_three" target\x3d"_blank" href\x3d"' + d + '" data-gid\x3d"' + c.gid + '" data-pid\x3d"' + c.pno + '" title\x3d"' + c.title + '"\x3e' + c.title + "\x3c/a\x3e");
            b.push("\x3cb\x3e\u4ef7\u503c\uff1a\uffe5" + c.goodsPrice + "\x3c/b\x3e");
            b.push('\x3cdiv class\x3d"w_line"\x3e\x3cspan style\x3d"width:' + (0 === c.selledTime / (c.goodsPrice / c.priceArea) * 100 || 1 <= c.selledTime / (c.goodsPrice / c.priceArea) * 100 ? c.selledTime / (c.goodsPrice / c.priceArea) * 100 : 1) + '%"\x3e\x3c/span\x3e\x3c/div\x3e');
            b.push('\x3cul class\x3d"w_number"\x3e');
            b.push('\x3cli class\x3d"w_amount"\x3e' + c.selledTime + "\x3c/li\x3e");
            b.push('\x3cinput type\x3d"hidden" id\x3d"cart_gid_' + e + '" value\x3d"' + c.gid + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"pid_' + e + '" value\x3d"' + c.pno + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"priceArea_' + e + '" value\x3d"' + c.priceArea + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"period_' + e + '" value\x3d"' + c.pno + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"priceTotal_' + e + '" value\x3d"' + c.goodsPrice + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"surplus_' + e + '" value\x3d"' + (c.goodsPrice / c.priceArea - c.selledTime) + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"thumbPath_' + e + '" value\x3d"' + c.thumbPath + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"maxBuy_' + e + '" value\x3d"' + c.maxBuy + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"title_' + e + '" value\x3d"' + c.title + '"/\x3e');
            b.push('\x3cinput type\x3d"hidden" id\x3d"cid_' + e + '" value\x3d"' + c.cid + '"/\x3e');
            b.push('\x3cli class\x3d"w_amount"\x3e' + c.goodsPrice / c.priceArea + "\x3c/li\x3e");
            b.push('\x3cli class\x3d"w_amount"\x3e' + (c.goodsPrice / c.priceArea - c.selledTime) + "\x3c/li\x3e");
            b.push("\x3cli\x3e\u5df2\u593a\u5b9d\u4eba\u6b21\x3c/li\x3e\x3cli\x3e\u603b\u9700\u4eba\u6b21\x3c/li\x3e");
            b.push("\x3cli\x3e\u5269\u4f59\u4eba\u6b21\x3c/li\x3e");
            b.push("\x3c/ul\x3e");
            b.push('\x3cdiv class\x3d"c_rob_box"\x3e');
            b.push('\x3cdiv class\x3d"c_cumulative_box"\x3e');
            b.push("\x3cstrong\x3e\u6211\u8981\u53c2\u4e0e\uff1a\x3c/strong\x3e");
            d = getBuyTimes(c.goodsPrice / c.priceArea, c.maxBuy);
            b.push('\x3cinput id\x3d"buyTimes_' + e + '" maxLength\x3d"6" onafterpaste\x3d"checkTimes(' + e + ')" onkeyup\x3d"checkTimes(' + e + ')" ');
            b.push('onmouseover\x3d"this.focus();this.select();" type\x3d"text" class\x3d"c_detailsinputs" value\x3d"' + d + '"\x3e');
            b.push('\x3cspan onclick\x3d"minusTimes(' + e + ')" class\x3d"c_addnew_subtracts"\x3e-\x3c/span\x3e');
            b.push('\x3cspan onclick\x3d"addTimes(' + e + ')" class\x3d"c_addnew_pluss"\x3e+\x3c/span\x3e');
            b.push("\x3c/div\x3e");
            b.push('\x3cdl class\x3d"w_rob"\x3e');
            99999 != c.cid ? (b.push('\x3cdd\x3e\x3ca class\x3d"w_slip" href\x3d"javascript:void(0);" onclick\x3d"gotoCart(' + e + ');gotoCartOrder()" \x3e\u7acb\u5373\u593a\u5b9d\x3c/a\x3e\x3c/dd\x3e'), b.push('\x3cdd class\x3d"w_rob_out"\x3e\x3ca  class\x3d"w_rob_in" href\x3d"javascript:void(0);" onclick\x3d"cartoon(' + e + ')"\x3e\u52a0\u5165\u8d2d\u7269\u8f66\x3c/a\x3e\x3c/dd\x3e')) : (b.push('\x3cdd\x3e\x3ca class\x3d"w_slip" href\x3d"' + experience_activity_address + '" target\x3d"_blank"\x3e\u7acb\u5373\u53c2\u4e0e\x3c/a\x3e\x3c/dd\x3e'), b.push('\x3cdd class\x3d"w_rob_out"\x3e\x3ca  class\x3d"w_rob_in" href\x3d"/goods/goods' + c.gid + "-" + c.pno + '.html" target\x3d"_blank"\x3e\u67e5\u770b\u8be6\u60c5\x3c/a\x3e\x3c/dd\x3e'));
            b.push("\x3c/dl\x3e");
            b.push("\x3c/div\x3e");
            1 === c.recommendFlag && b.push('\x3ci class\x3d"w_hot"\x3e\x3c/i\x3e');
            1 === c.popularityFlag && b.push('\x3ci class\x3d"w_hot_three"\x3e\x3c/i\x3e');
            10 == c.priceArea && b.push('\x3cspan class\x3d"w_zone"\x3e\u5341\u5143\u4e13\u533a\x3c/span\x3e');
            100 == c.priceArea && b.push('\x3cspan class\x3d"w_zone w_zone_bai"\x3e\u767e\u5143\u4e13\u533a\x3c/span\x3e');
            0 != c.maxBuy && b.push('\x3cspan class\x3d"w_zone w_zone_xg"\x3e\u9650\u8d2d\u4e13\u533a\x3c/span\x3e');
            99999 == c.cid && b.push('\x3cspan class\x3d"w_zone w_zone_jisu"\x3e\u65b0\u624b\u4e13\u533a\x3c/span\x3e\x3c/li\x3e');
            speedCid && c.cid == speedCid && b.push('\x3cspan class\x3d"w_zone w_zone_jisu"\x3e\u6781\u901f\u4e13\u533a\x3c/span\x3e\x3c/li\x3e');
            b.push("\x3c/li\x3e");
            e++;
            3 === a % 4 && b.push("\x3c/ul\x3e")
        });
        $(".w_goods_con").html(b.join(""));
        $(".c_join_all").show();
        var g = $(".w_goods_con .w_goods_one:last"),
            f = g.find(".w_goods_details").length;
        if (0 < f && 4 > f)
            for (e = 4 - f; 0 < e; e--) g.append('\x3cli class\x3d"w_goods_details "\x3e\x3cimg src\x3d"/static/img/front/goods/expect.jpg"/\x3e\x3c/li\x3e');
        lazyload(page);
        a.goods || $("#pageStr").html("\x3cimg src\x3d'/static/img/lis_icon.png'/\x3e");
        pageCount = a.goods.totalPage;
        page = a.goods.page;
        listPage(d)
    }
}

function addTimes(a) {
    if (0 == $("#maxBuy_" + a).val()) {
        var d = $("#buyTimes_" + a).val();
        parseInt(d) < parseInt($("#surplus_" + a).val()) && $("#buyTimes_" + a).val(parseInt(d) + 1)
    }
}

function minusTimes(a) {
    if (0 == $("#maxBuy_" + a).val()) {
        var d = $("#buyTimes_" + a).val();
        0 < d && $("#buyTimes_" + a).val(parseInt(d) - 1)
    }
}

function checkTimes(a) {
    if (0 == $("#maxBuy_" + a).val()) {
        var d = $("#buyTimes_" + a).val();
        !isNaN(d) && 0 > d.indexOf(".") && "" != d ? parseInt(d) > parseInt($("#surplus_" + a).val()) && $("#buyTimes_" + a).val($("#surplus_" + a).val()) : $("#buyTimes_" + a).val(getBuyTimes($("#priceTotal_" + a).val() / $("#priceArea_" + a).val(), $("#maxBuy_" + a).val()))
    } else $("#buyTimes_" + a).val($("#maxBuy_" + a).val())
}

function bindCategory(a) {
    a.status && ($(".w_choose_list a[data-id\x3d" + a.category.fid + "]").addClass("w_selected"), $(".w_guide").html('\x3ca href\x3d"/"\x3e\u9996\u9875\x3c/a\x3e\x3ca href\x3d"/goods/allCat.html"\x3e\u5168\u90e8\u5546\u54c1\x3c/a\x3e\x3ca href\x3d"/goods/allCat' + a.category.fid + '.html"\x3e' + $(".w_selected b").text() + '\x3c/a\x3e\x3ca class\x3d"w_accord" href\x3d"javascript:void(0);"\x3e' + a.category.cname + "\x3c/a\x3e"), getAllCat(a.category.fid), getAllBrand(a.category.id), $(".w_goods_class .w_effect").removeClass("w_effect"), $(".w_goods_class li a[data-id\x3d" + a.category.id + "]").addClass("w_effect"))
}

function bindAllBrand(a) {
    $(".w_specific_class1 ul").html('\x3cli\x3e\x3ca class\x3d"w_effect c_all_effect" href\x3d"javascript:void(0);"\x3e\u5168\u90e8\x3c/a\x3e\x3c/li\x3e');
    a.status && ($(a.brands).each(function (a, b) {
        9 > a ? $(".w_specific_class1 ul").append('\x3cli\x3e\x3ca href\x3d"javascript:void(0);" data-id\x3d"' + b.id + '"\x3e' + b.bname + "\x3c/a\x3e\x3c/li\x3e") : 9 == a ? $(".w_specific_class1 ul").append('\x3cspan class\x3d"w_right_more"\x3e\u5c55\u5f00\x3c/span\x3e\x3cli class\x3d"w_recharge_more" \x3e\x3ca href\x3d"javascript:void(0);" data-id\x3d"' + b.id + '"\x3e' + b.bname + "\x3c/a\x3e\x3c/li\x3e") : $(".w_specific_class1 ul").append('\x3cli class\x3d"w_recharge_more" \x3e\x3ca href\x3d"javascript:void(0);" data-id\x3d"' + b.id + '"\x3e' + b.bname + "\x3c/a\x3e\x3c/li\x3e")
    }), $(".w_specific_class1 ul").append('\x3cspan class\x3d"w_left_more"\x3e\u6536\u8d77\x3c/span\x3e'))
}

function bindAllCat(a) {
    a.status && ($(".w_goods_class").hide(), $(a.categorys).each(function (a, b) {
        $(".w_specific_class ul").append('\x3cli\x3e\x3ca href\x3d"javascript:void(0);" data-id\x3d"' + b.id + '"\x3e' + b.cname + "\x3c/a\x3e\x3c/li\x3e")
    }))
}

function bindCategoryOne(a) {
    if (a.status) {
        speedCid = a.speedCid;
        var d = [];
        $(a.categorys).each(function (a, e) {
            7 > a ? d.push('\x3cdd\x3e\x3ca href\x3d"javascript:void(0);" data-id\x3d"' + e.id + '"\x3e\x3cspan class\x3d"w_icon w_icon_' + icon[a] + '"\x3e\x3c/span\x3e\x3cb\x3e' + e.cname + "\x3c/b\x3e\x3c/a\x3e\x3c/dd\x3e") : 7 == a && d.push('\x3cdd class\x3d"w_special"\x3e\x3ca href\x3d"javascript:void(0);" data-id\x3d"' + e.id + '"\x3e\x3cspan class\x3d"w_icon w_icon_' + icon[a] + '"\x3e\x3c/span\x3e\x3cb\x3e' + e.cname + "\x3c/b\x3e\x3c/a\x3e\x3c/dd\x3e")
        });
        d.push('\x3cdiv class\x3d"w_clear"\x3e\x3c/div\x3e');
        $(".w_choose_list").html(d.join(""))
    }
}

function showGoodsCB(a, d) {
    0 != a && (0 != $(".w_choose_list a[data-id\x3d" + a + "]").length ? ($(".w_choose_list a[data-id\x3d" + a + "]").addClass("w_selected"), $(".w_guide").html('\x3ca href\x3d"/"\x3e\u9996\u9875\x3c/a\x3e\x3ca href\x3d"/goods/allCat.html"\x3e\u5168\u90e8\u5546\u54c1\x3c/a\x3e\x3ca class\x3d"w_accord" href\x3d"javascript:void(0);"\x3e' + $(".w_selected b").text() + "\x3c/a\x3e"), getAllBrand(a)) : getCategory(a), 0 != d && ($(".w_goods_brand .w_effect").removeClass("w_effect"), $(".w_goods_brand li a[data-id\x3d" + d + "]").addClass("w_effect")), $(".w_all_class").show())
}

function getGoods(a) {
    a = {
        cid: $(".w_selected").attr("data-id"),
        bid: $(".w_specific_class1 .w_effect").attr("data-id"),
        q: $("#q").val(),
        order: $(".w_product_con .w_announced").attr("data-id"),
        baoyuan: $(".bao_yuan").attr("data-id"),
        size: "40",
        page: a
    };
    getGoodsList(a)
}

function gotoCart(a) {
    gotoCartOrder(a)
}

function cartoon(a) {
    var c = $("#mid").val();
    var d= $("#sta").val();
    if(null != c && "" != c){
        if(d == '2'){//账号处于激活状态
            addCart(a);
            if ($(".shoppingCartRightFix").is(":visible")) {
                a = $("#img_" + a);
                var b = a.clone().css("opacity", .75);
                $("body").append(b);
                b.css({
                    "z-index": 9E3,
                    display: "block",
                    position: "absolute",
                    top: a.offset().top + "px",
                    left: a.offset().left + "px",
                    width: a.width() + "px",
                    height: a.height() + "px"
                });
                b.animate({
                    top: $(".shoppingCartRightFix").offset().top,
                    left: $(".shoppingCartRightFix").offset().left,
                    width: 40,
                    height: 26
                }, "slow", function () {
                    b.remove()
                })
            }
        }else if(d == '3'){//账号处于冻结状态
            layer.msg('账号处于冻结状态,请联系管理员解封',{offset: '300px',time: 2000,icon: 7});
        }
    }else{
        go2Login();
    }

    
}

function listPage(a) {
    $("#pageStr").createPage({
        pageCount: pageCount,
        current: page,
        backFn: function (d) {
            a.page = d;
            ajaxGoodsListTopGoods(a, bindGoodsList);
            $("body,html").animate({
                scrollTop: 0
            }, 500)
        }
    })
}

function addAllGoodsToCart() {
    for (var a = 0; 40 >= a; a++) {
        var d = $("#cart_gid_" + a).val();
        "undefined" != typeof d && 99999 != $("#cid_" + a).val() && addCart(d, getBuyTimes($("#priceTotal_" + a).val() / $("#priceArea_" + a).val(), $("#maxBuy_" + a).val()))
    }
    window.location.href = "/cart/cartOrder.do"
}

function getBuyTimes(a, d) {
    return 0 != d ? d : 0 < a && 3500 > a ? 1 : 3500 <= a && 5E3 > a ? 5 : 10
}

function baiduTag_list() {
    _hmt.push(["_trackRTEvent", {
        data: {
            ecom_page: {
                page_type: "list",
                p_brand: bd_brand,
                p_class1: bd_class1,
                p_class2: bd_class2
            }
        }
    }])
};