
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="<?php echo $_SESSION['sc']['infor']['keywords']?>"></meta>
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>"></meta>
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" /> 
<title>购物车--万花筒</title>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/comm.min.css"></link>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/footer_header.min.css"></link>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/index.min.css"></link>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/new_join.min.css"></link>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/goods.min.css"></link>
<script type="text/javascript" src="__PUBLIC__/Home/static/js/uaredirect.js"></script>
<link rel="stylesheet" href="__PUBLIC__/Home/static/min.css/css/page.css"/>
<script type="text/javascript" src="__PUBLIC__/Home/static/js/jquery-1.11.3.js"></script>
<style>
.yFootBottomLeft {
    width: 480px;
}
.cart_all{width:1200px;margin:10px auto;}
.cart_all>table{width:1200px;border-collapse:collapse;border-spacing:0;border:1px solid #ddd;}
.cart_all>table th{border-bottom:1px solid #ddd;font-size:14px;font-weight:normal;background-color:#eee;line-height:30px;}
.cart_all>table tr:hover{background:#eee;}
.cart_all>table td{border-bottom:1px solid #ddd;text-align:center;cursor:pointer;}
.cart_all>table td>a>img{float:left;width:50px;height:50px;margin:10px;}
.cart_all>table td>p{margin-top:24px;font-size:14px;}
.cart_all>table td>p>a{font-size:16px;color:#333333;}
.cart_all>table td>p>a:hover{color:red;}
.cart_all>table td>p>span{color:red;}
.cart_all>table td>span{color:red;}
.cart_all>table td>div{width: 120px;margin:0px auto;}
.cart_in{display:block;float:left;width:30px;height:30px;background:#eee;border:1px solid #ddd;text-align:center;line-height:28px;cursor:pointer;border-top-left-radius:3px;border-bottom-left-radius:3px;}
.cart_out{display:block;float:left;width:30px;height:30px;background:#eee;border:1px solid #ddd;text-align:center;line-height:28px;cursor:pointer;border-top-right-radius:3px;border-bottom-right-radius:3px;}
.cart_all>table td>div>input{text-align:center;display:block;float:left;outline:none;border:1px solid #ddd;margin-left:-1px;margin-right:-1px;height:30px;width:50px;}
.cart_all>table td>a{color:#333333;}
.cart_aftab{width:1198px;border:1px solid #ddd;border-top:none;}
.cart_aftab_left{float:left;margin-left:20px;margin-top:30px;}
.cart_aftab_left>span{font-size:14px;color:#555555;}
.m_l_20{margin-left:20px; cursor: pointer;}
.cart_aftab_right{float:left;padding-top: 10px;width: 800px;overflow: hidden;margin-left: 66px;}
.cart_aftab_right>p{font-size:14px;margin:0px;margin-top:20px;float: left;padding-right: 20px;float: right;}
.cart_aftab_right>p>span{color:red;}
.f_s_20{font-size:20px;}
.cart_aftab_bottom{margin-top:20px;margin-left:20px;margin-bottom:10px;}
.cart_aftab_bottom>span{font-size:14px;color:#555555;}
.sel_outline{outline:none;border:1px solid red;margin-left:30px;}
.cart_aftab1{width:1198px;border:1px solid #ddd;border-top:none;}
.cart_aftab1>input{margin-left:25px;margin-top:20px;margin-bottom:20px;}
.cart_aftab1>span{font-size:14px;color:#555555;}
.cart_aftab1>span>b{font-size:28px;color:red;margin:5px;}
.pay{width:1198px;border:1px solid #ddd;border-top:none;}
.pay_btn{float:right;margin-top:20px;margin-right:20px;margin-bottom:30px;}
.pay_btn>input{background:#dd2726;border:1px solid #d3141c;width:200px;height:50px;color:white;cursor:pointer;font-size:18px;}
.pay_btn>input:hover{background:#d3141c;}
.forbidden{display:inline-block;width:30px;height:30px;background:#eee;border:1px solid #ddd;text-align:center;line-height:28px;border-top-left-radius:3px;border-bottom-left-radius:3px;cursor: default;}
.gtype{ background-color: #dd2726; color: #fff !important; display: inline-block;}
.c_quick_shop{
	display: block;
	width: 150px;
	height: 40px;
	color: #fff;
	background: #dd2726;
	text-align: center;
	line-height: 40px;
}
.c_no_left p{
	font-size: 30px;
	color: #666666;
	margin: 60px 0 22px;
}
.c_no_left{
	float: left;
	width: 280px;
	margin-right: 40px;
}
.c_no_right{
	float: left;
	width: 256px;
}
.c_no_goods{
	margin: 110px auto;
	width: 580px;
	overflow: hidden;
}
.c_no_right img{
	width: 114px;
	height: 133px;
	margin-top: 60px;
	margin-left: 62px;
}
.menu1{ display: none;}
.zfb{ display: none;}
.tip{padding: 10px;display: block; text-align:center; margin-bottom: 10px;}
.done{ width:40%;background:#d3141c; color: #ffffff;margin:0 11px 10px 11px; padding: 3px; display: inline-block; text-align: center; cursor:pointer;}
.reset{ width:40%;background:gray; color: #ffffff;margin:0 11px 10px 11px; padding: 3px;display: inline-block;text-align: center; cursor: pointer;}
#popup_message{padding: 0;}
.buynum {
	float: left;
	width: 50px;
	text-align: center;
	height: 30px;
	border-top: 1px solid #ccc;
	border-bottom: 1px solid #ccc;
	line-height: 30px;
}
.cart_in2{
	display: block;
    float: left;
    width: 30px;
    height: 30px;
    background: #eee;
    border: 1px solid #ddd;
    text-align: center;
    line-height: 28px;
    cursor: pointer;
    border-top-left-radius: 3px;
    border-bottom-left-radius: 3px;
}
.cart_out2{
	display: block;
    float: left;
    width: 30px;
    height: 30px;
    background: #eee;
    border: 1px solid #ddd;
    text-align: center;
    line-height: 28px;
    cursor: pointer;
    border-top-right-radius: 3px;
    border-bottom-right-radius: 3px;
}
</style>	
</head>
<body>
<!--顶部nav-->
<include file="public:head" />
<!--banner上方的nav-->
<!--右侧的图标悬浮-->
<include file="public:right" />
<!--右侧的图标悬浮-->

	<div class="cart_all">
		<h4 style="font-size: 20px;padding-bottom:10px;padding-left: 10px;">确认订单信息</h4>
		<table id="shopcart">
			<tr>
				<th>#</th>
				<th>商品</th>
				<th>分类</th>
				<th>可用金</th>
				<th>消费币</th>
				<th>数量</th>
				<th>小计</th>
				<th>操作</th>
			</tr>
			<volist name="cartlist" id="list">
				<tr>
					<td><input type="checkbox" class="check_alls" name="items"  value="<{$list.id}>" checked="checked"/></td>
					<td>
						<a href="<{:U('Good/goodlist',['id'=>$list['id']])}>" target="_blank"><img src="__ROOT__/Uploads<{$list.goods_logo}>"></a>
						<p ><a target="_blank" href="<{:U('Good/goodlist',['id'=>$list['id']])}>" title="<{$list.goods_title}>">
							<?php if (strlen($list['goods_title'])>20) {
									echo mb_substr($list['goods_title'],0,20,'utf-8').'...';
								}else{
									echo $list['goods_title'];
								}
							?>
						</a></p>
					</td>
					<td><{$list.name}></td>
					<td>
						<span class="paynum"><{$list.price}></span>
					</td>
					<td>
						<span class="cfbnum"><{$list.xfb}></span>
					</td>
					<td>
						<if condition="$list[kucun] elt 1">
							<div class="datatype" type="1" data-limit="<{$list.kucun}>" data-id="<{$list.id}>">
								<span class="cart_in2 " >-</span>
								<span class="buynum onlyNum" id="cart_inp1" disabled='disabled'><{$list.buynum}></span>
								<span class="cart_out2 ">+</span>
							</div>
						<else/>
							<div class="datatype" type="1" data-limit="<{$list.kucun}>" data-id="<{$list.id}>">
								<span class="cart_in" >-</span>
								<span class="buynum onlyNum" id="cart_inp1"><{$list.buynum}></span>
								<span class="cart_out">+</span>
							</div>
						</if>
						<input type="hidden" id="mid" value="<?php echo $_SESSION['sc']['id']?>"/>
						<input type="hidden" id="sta" value="<?php echo $_SESSION['sc']['status']?>"/>
						<input type="hidden" id="buynum_<{$list.id}>" value="<{$list.buynum}>">
					</td>
					<td>
						<span class="paysum"><?php $paynum=$list['price']*$list['buynum'];$xfbnum=$list['xfb']*$list['buynum'];$fukuan=$paynum+$xfbnum;echo $fukuan;?></span>
					</td>
					<td>
						<input type="hidden" value="<{$list.id}>" name="goodid">
						<input type="hidden" value="<{$list.cart_id}>" name="cid">
						<a class="del" href="javascript:void(0);">删除</a>
					</td>
				</tr>
			</volist>
		</table>
		<div class="cart_aftab">
			<div class="cart_aftab_top">
				<div class="cart_aftab_left">
					<input type="checkbox" id="sss" onclick="checkall(this)" checked="checked"/><span>全选<span>
				</div>
				<div class="cart_aftab_right">
					<p style="margin-right:5px;">支付总额：<span class="f_s_20 payfor"></span></p>
					<p style="margin-right:5px;">支付消费币：<span class="f_s_20 payprice"></span></p>
					<p style="margin-right:5px;">支付可用金：<span class="f_s_20 payxfb"></span></p>
					<p style="margin-right:5px;">已选择商品：<span class="f_s_20 payNumber"></span></p>
				</div>
				<div class="pay_btn">
					<input type="button" id="cartpay" value="去结算">
				</div>
				<div style="clear:both;"></div>
			</div>
		</div>	
	</div>
<!--foot部分-->
<!--四个图标-->
<include file="public:foot" />	
<div class="jd"></div>
<!--foot部分-->
</body>
<script type="text/javascript" src="/Public/Home/static/min.js/js/include/footer_header_new.min.js"></script>
<script src="__PUBLIC__/Home/static/js/cart.js"></script>
<script src="__PUBLIC__/Admin/javascripts/layer/layer.js"></script>
<script type="text/javascript">
$(function(){
	add();
})
function cartCount() {}
var j = 0;
var o = 0;
var w = 0;
	// 合计金额函数封装
	function add(){
		var aa =$('#shopcart').children('tbody').children('tr').children('td').children('.paysum');
		var ipt = $('#shopcart .check_alls');
		j = 0;
		o = 0;
		w = 0;
		for (var i = 0; i < $('#shopcart .check_alls').length; i++) {
			if($(ipt[i]).is(':checked')){
				o = o + parseInt($(ipt[i]).parent().siblings().children('.paysum').html());//总额
				w = w + $(ipt[i]).parent().siblings().children('.paynum').html()*$(ipt[i]).parent().siblings().children('.datatype').children('.buynum').html();//可用金
				j = j + parseInt($(ipt[i]).parent().siblings().children('.cfbnum').html() * $(ipt[i]).parent().siblings().children('.datatype').children('.buynum').html());//消费币
			}
		}
		$('.cart_aftab_right>p span.payprice').html(j); //消费币
		$('.cart_aftab_right p span.payxfb').html(w);//可用金
		$('.cart_aftab_right p span.payfor').html(o);//总额
	}
	function checkall(qx){
		var num='';
	  	//$(".check_alls").prop("checked",qx.checked);
	  	$('input[name="items"]').each(function(k,v){  
            //此处如果用attr，会出现第三次失效的情况  
            if($(this).is(':checked')){
            	//$(this).prop("checked",false); 
            }else{
             	$(this).prop("checked",true); 
            }
            num += k;
		        $(".payNumber").text(num.length);
        });  
        add();
	}
	$('input[name="items"]').change(function(){ 
		var num=''; 
        $("input[name=items]").each(function(k,v) { 
            if ($(this).is(":checked")) { 
            	num += k;
            }  else{
            	$("#sss").removeAttr("checked",false);
            }
        });
		$(".payNumber").text(num.length);
    }); 
	$(function(){
		var num='';
		$("input[name=items]").each(function(k,v) {  
            if ($(this).attr("checked")) { 
            	num += k;
            }  
        });
		$(".payNumber").text(num.length);
	})
	var i = 0;
	$(function(){
		// 点击 + 
		$('.cart_out').click(function(){		
			if($(this).parent().parent().siblings().children('.check_alls').is(':checked')){
				i = parseInt($(this).siblings('.buynum').html());
				limit= parseInt($(this).siblings('.buynum').parents('div').data('limit'));
				gid= parseInt($(this).siblings('.buynum').parents('div').data('id'));
				if(i >= limit){//最大值
					i = limit;
				}else {
					num = i++;
				}
				$(this).siblings('.buynum').html(i);
				$(this).parent().parent().next().children('.paysum').html(i * $(this).parent().parent().siblings().children('.paynum').html()+i * $(this).parent().parent().siblings().children('.cfbnum').html());
				add();
				$('.cart_aftab_right>p span.payprice').html(j); //消费币
				$('.cart_aftab_right p span.payxfb').html(w);//可用金
				$('.cart_aftab_right p span.payfor').html(o);//总额
				$("#buynum_"+gid).val(i);
			}
		})
		// 点击-
		$('.cart_in').click(function(){
			
			if($(this).parent().parent().siblings().children('.check_alls').is(':checked')){
				i = parseInt($(this).siblings('.buynum').html());
				gid= parseInt($(this).siblings('.buynum').parents('div').data('id'));
				if(i <= 1){
					i = 1;
				}else {
					num = i--;
				}
				$(this).siblings('.buynum').html(i);


				$(this).parent().parent().next().children('.paysum').html(i * $(this).parent().parent().siblings().children('.paynum').html()+i * $(this).parent().parent().siblings().children('.cfbnum').html());
				add();
				$('.cart_aftab_right>p span.payprice').html(j); //消费币
				$('.cart_aftab_right p span.payfor').html(o);//总额

				// console.log(w)

				$('.cart_aftab_right p span.payxfb').html(w);//可用金
				$("#buynum_"+gid).val(i);
			}

		})
		// 判断是否选中
		var ipt = $('#shopcart .check_alls');
		var nub = 0;
		ipt.change(function(){
			add();			
		})
	})
	$(".del").click(function(){
		var url = "<{:U('Cart/orderdel')}>";
        var id=$("input[name=cid]").val();
        layer.confirm('您确定要删除吗？', {
          btn: ['确定','取消'] //按钮
        }, function(){
            $.ajax({
                type : 'post',
                url : url,
                data : {id:id},
                error : function () {
                    layer.msg('网络故障，请稍后重试!',{offset: '300px',time: 1500,icon: 7});
                },
                success : function (responses) {
                    if (responses == 'ok'){
                        layer.msg('删除成功',{offset: '300px',time: 1500,icon: 1},function () {
                           window.location.reload();
                        });
                    }else{
                        layer.msg(responses,{offset: '300px',time: 1500,icon: 2});
                    }
                }
            });
        });
	})
	/**
 * 跳转到结算页面
 */
function gotoCartOrder(){
	var a = $("#mid").val();
    var b = $("#sta").val();
    if(b == '2'){//账号处于激活状态
        window.location.href = "<{:U('Order/confirm_order')}>";
    }else if(b == '3'){//账号处于冻结状态
        layer.msg('账号处于冻结状态,请联系管理员解封',{offset: '300px',time: 2000,icon: 7});
    }
}
</script>
</html>