<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="" />
<meta name="author" content="网页作者的资料"/>
<meta name="keywords" content="<?php echo $_SESSION['sc']['infor']['keywords']?>"></meta>
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>"></meta>
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" /> 
<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE"/> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="renderer" content="webkit"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/min.css/new/css/header_footer.min.css"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/min.css/new/css/member.min.css"/>
<title>商家中心--修改商品--方大商城</title>
<style type="text/css">
    .c_address_in{
    height:528px;
    }
    .c_address{
    padding-left:14px;
    }
    .c_form_con{
    width:785px;
    }
    .c_form_con label{
    width:115px;
    }
    select{
       background: transparent;
       appearance:none;
        -moz-appearance:none;
        -webkit-appearance:none;
       width: 180.5px;
       height: 34px;
       -webkit-appearance: none;
       margin-left: -10px;
       margin-top: 2px;
       border-width:0px;
       line-height: 34px;
       font-size:14px;
       padding-right: 40px;
    }
    .select_showbox{
       overflow: hidden;
    }
    select::-ms-expand { display: block; }

    .c_out_a i, .c_first_out_a i {
        background: rgba(0, 0, 0, 0) url("/Public/Home/static/new/img/icon/member_comm/left_icon.png") no-repeat scroll 0 0;
    }

    .top{
        margin: 90px 0 70px 0;
        height: 200px;
    }
    .top p{
        position: relative;
        margin-top: 20px;
    }
    .c_form_con div .top input.uploading{
      opacity: 0;
      width: 148px;
      height: 34px;
      position: absolute;
      top: 0;
      left: 0;
    }
    .top>span {
        position: relative;
        display: block;
    }
    .top span img{
        display: block;
        border: 1px solid #ccc;
        background: #fff;
    }
    .top span i{
        position: absolute;
        width: 20px;
        height: 20px;
        left: 155px;
        top: -10px;
        border-radius: 50%;
        line-height: 20px;
        text-align: center; 
        font-size: 14px;
        border: 1px solid #000; 
    }
    .top span img{
        width:160px;
        height: 160px;
    }

    .bottom{
        float: left;
        width: 20%;
        height: 150px;
    }
    .bottom p{
        position: relative;
        width: 100%;
        /*overflow: hidden;*/
        padding: 0 5px;
        box-sizing: border-box;
    }
    .bottom p img{
        width: 100%;
        margin-top: -30px;
    }
    .c_form_con div .bottom input.uploading{
      opacity: 0;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      padding: 0;
      margin-top: -30px;
    }
    .bottom>span {
        position: relative;
        display: block;
        width: 100px;
        height: 100px;
        border: 1px solid #ccc;
         margin: 0 14px;
    }
    .bottom span img{
        display: block;
        width: 100px;
        height: 100px;
      
    }
    .bottom span i{
        position: absolute;
        width: 20px;
        height: 20px;
        right: -10px;
        top: -10px;
        border-radius: 50%;
        line-height: 20px;
        text-align: center; 
        font-size: 14px;
        border: 1px solid #000; 
    }
    .bottom span img{
        width:100px;
        height: 100px;
        background: #fff;
    }
    .img {
        position: absolute;
    }
    .img img{
        width: 100px;
        margin: 0px 15.5px;
        height: 102px;
    }
    .tit{
        position: absolute;
    }
 .aba{
    position: relative;

 }
</style>
</head>
<body>
  <!-- S 头部 -->
  <!-- 引入头部 -->
    <include file="public:mhead" />
    <!-- 引入头部 -->
  <!-- E 头部 -->
  <!-- S 内容区域 -->
  <div class="b_sup_content">
      <!-- S 会员资料 -->
      <!--S 头部 -->
      <!-- E 会员资料 -->
      <div id="content_box" class="">
        <!-- S 左侧 -->
        <include file="public:mleft" />
        <!-- E 左侧 -->
        <!-- S 右侧 -->
        <div id="member_right" class="member_right">
        <!-- 数据列表栏 -->
        <div class="c_address" id="datalist">
        <form id="fbg">
            <div class="c_address aa">
                <div class="c_form_con">
                    <label>商品分类：</label>
                    <ul class="c_form_right">
                        <li class="c_contact">
                            <div class="select_showbox" id="provinceDiv">
                              <select style="display: block;" name="p_id" id="pid">
                                <volist name="goodclass" id="list">
        <option value="<{$list.goods_class_id}>" <if condition="$list[goods_class_id] eq $goods['goods_cate_pid']">selected</if>><{$list.name}></option>
                                </volist>
                              </select>
                            </div>
                        </li>
                        <li class="c_contact">
                            <div class="select_showbox" id="provinceDiv">
                              <select style="display: block;" name="son_id" id="sonclass">
        <option value="<{$datas.goods_class_id}>" ><{$datas.name}></option>
                              </select>
                            </div>
                        </li>
                    </ul>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con c_newform_con">
                    <label>商品标题：</label>
                    <div class="c_form_right">
                        <input class="c_details_address" type="text" name='title' placeholder="宝贝标题"  maxlength="100" datacol='yes' checkexpession='NotNull' err='宝贝标题' value="<{$goods.goods_title}>"/>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con c_newform_con">
                    <label>副标题：</label>
                    <div class="c_form_right">
                        <input class="c_details_address" type="text" name='small' placeholder="副标题"  maxlength="50" datacol='yes' checkexpession='NotNull' err='副标题' value="<{$goods.goods_small_title}>"/>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con">
                    <label>商品价格：</label>
                    <div class="c_form_right">
                        <input class="c_details_contact" type="text" name="my"  placeholder="商品价格" maxlength="11" datacol='yes' checkexpession='Num' err='请填写商品价格，并且必须为' value="<?php echo  (int)$goods['money']?>"/> <span style="line-height: 26px; color:#555;font-size:14px;">( 商品实际价格，按照可用金价格+消费币价格 计算 )</span>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con">
                    <label>可用金价格：</label>
                    <div class="c_form_right">
                        <input class="c_details_contact" type="text" name="pic" placeholder="可用金价格" maxlength="11" datacol='yes' checkexpession='Num' err='请填写可用金价格，并且必须为' value="<?php echo  (int)$goods['price']?>"/>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con">
                    <label>消费币价格：</label>
                    <div class="c_form_right">
                        <input class="c_details_contact" type="text" name="xfb" placeholder="消费币价格" maxlength="11" datacol='yes' checkexpession='Num' err='请填写消费币价格，并且必须为' value="<?php echo  (int)$goods['xfb']?>"/>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con">
                    <label>商品库存：</label>
                    <div class="c_form_right">
                        <input class="c_details_contact" type="text" name="num" id="zfbAccount"  placeholder="商品库存" maxlength="11"  datacol='yes' checkexpession='Num' err='请填写商品库存，并且必须为' value="<{$goods.kucun}>"/>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con abc">
                    <label>商品图片：</label>
                <div class="c_form_right aba">
                    <div class="top"> 
                        <h3 style="position: absolute;top:0;">
                            <span style="color:red;font-size:20px;">商品Logo图片</span>
                            <span style="line-height: 26px; color:#555;font-size:14px;">（图片类型：'jpeg','png','jpg','gif'，图片尺寸：(220px*220px)）</span>
                            <img style="position: absolute;left: 0;top: 91px;width:160px;height:160px;" src="__ROOT__/Uploads<{$goods.goods_logo}>" alt="" />
                        </h3>
                        <p>
                            <input style="margin-top:-40px;" class="uploading" type="file" name="logo" multiple="multiple" accept="image/*" />
                            <img style="margin-top:-40px;" src="/Public/Home/static/new/img/icon/uploading.png" alt="" />
                        </p>
                    </div>
                    <div class="img">
                    <?php
                        $imgarr=M('goods_imgs')->where(['gid'=>$goods['id']])->order('id asc')->select();
                    ?>    
                    <volist name="imgarr" id="list">                    
                        <img src="__ROOT__/Uploads<{$list.showlogo}>"/>
                    </volist>
                    </div>
                    <div class="bottom" style="position: relative;"> 
                        <h3 style="position: absolute;top: -85px;width:1000px;">
                            <span style="color:red;font-size:20px;">商品页详情展示图</span>
                            <span style="line-height: 26px; color:#555;font-size:14px;">(图片类型：'jpeg','png','jpg','gif'图片尺寸：(400px*400px))</span><br>
                            <span>友情提示：商品页详情展示图如修改，会清空以前所有的展示图片。</span>
                        </h3>
                        <p>
                            <input class="uploading" type="file" name="showlogo1" multiple="multiple" accept="image/*" />
                            <img src="/Public/Home/static/new/img/icon/uploading.png" alt="" />
                        </p>
                    </div>
                    <div class="bottom"> 
                        <p>
                            <input class="uploading" type="file" name="showlogo2" multiple="multiple" accept="image/*" />
                            <img src="/Public/Home/static/new/img/icon/uploading.png" alt="" />
                        </p>
                    </div>
                    <div class="bottom"> 
                        <p>
                            <input class="uploading" type="file" name="showlogo3" multiple="multiple" accept="image/*" />
                            <img src="/Public/Home/static/new/img/icon/uploading.png" alt="" />
                        </p>
                    </div>
                    <div class="bottom"> 
                        <p>
                            <input class="uploading" type="file" name="showlogo4" multiple="multiple" accept="image/*" />
                            <img src="/Public/Home/static/new/img/icon/uploading.png" alt="" />
                        </p>
                    </div>
                    <div class="bottom"> 
                        <p>
                            <input class="uploading" type="file" name="showlogo5" multiple="multiple" accept="image/*" />
                            <img src="/Public/Home/static/new/img/icon/uploading.png" alt="" />
                        </p>
                    </div>
                </div>
          </div>
        <div style="clear: both;height: 30px;"></div>
        </div>
            <div class="c_form_con" style="height:356px;">
            <label>商品详情：</label>
              <div class="c_form_right">
                <script id="editor" name="cont" type="text/plain" style="height:300px;"><{$goods.cont}></script>
              </div>
        </div>
        <div style="clear: both;"></div>
        <div>
            <input type="hidden" name="setid" value="<?php echo $_GET['item']?>">
            <button class="c_save" style="display: block;" type="button">发布</button>
        </div>
        </div>
      </form>
    </div>
    </div>
  </div>
  <!-- S 底部 -->
<include file="public:pfoot" />
<script src="__PUBLIC__/Admin/javascripts/jquery.min.js"></script>
<script src="__PUBLIC__/Admin/javascripts/layer/layer.js"></script>
<script src="__PUBLIC__/Admin/javascripts/JValidator.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/ueditor.all.min.js"> </script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript">
//实例化编辑器
//建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
var cont1=UE.getEditor('editor',{toolbars: [
    ['fullscreen', 'source', 'undo', 'fontfamily','fontsize','redo', 'bold','italic', 'underline','formatmatch','selectall', 'pasteplain','time','date','simpleupload', 'insertimage','forecolor','justifyleft','justifyright','justifycenter','justifyjustify',]
]});
</script>
<script>
    $(function(){
        var array = [];
        for(var j = 0;j<$('.aba').children('div').length;j++){
            array.push([])
        }
        $(".uploading").change(function(){
            var objUrl = getObjectURL(this.files[0]);
            var bb = $(this).parent().parent().index();
            if (objUrl) {
                var cc = array[bb].length;
                array[bb][cc] = objUrl;
                var aa = $(this).parent().parent().children('span').length;
                for(var i = aa;i<array[bb].length;i++){
                    $(this).parent().parent().append('<span><img src="'+array[bb][i]+'"/><i>×</i></span>');
                }
                if ($(this).parent().parent().children('span').length > 0) {
                    $(this).parent().css('display','none')
                }
                return false;   
            }
        });
        function getObjectURL(file) {
            var url = null ;
            if (window.createObjectURL!=undefined) { // basic
                url = window.createObjectURL(file) ;
            } else if (window.URL!=undefined) { // mozilla(firefox)
                url = window.URL.createObjectURL(file) ;
            } else if (window.webkitURL!=undefined) { // webkit or chrome
                url = window.webkitURL.createObjectURL(file) ;
            }
            return url ;
        }
        $(".aba").on('click','div span i', function() {
            var bb = $(this).parent().parent('div').index()
            var cc = $(this).parent().index();
            console.log(cc)
            array[bb].splice(0,1)  
            $(this).parent().parent().children('p').children('input').attr('type','button')
            $(this).parent().parent().children('p').children('input').attr('type','file')
            if ($(this).parent().parent().children('span').length == 1) {
                $(this).parent().parent().children('p').css('display','block')
                $(this).parent().remove();
            }
        })
    })
</script>
<script>
$("#pid").change(function(){
    var procode=$(this).val();
    var url = "<{:U('Merchant/sonClass')}>";
    if(procode==0){
          var html = "<option value='0'>------请选择分类------</option>"; 
          $('#sonclass').html(html);
    }else{
        $.post(url,{pid:procode},function(data){
            $('#sonclass').empty();
             var html = "<option value='0'>------请选择分类------</option>";
            $.each(data, function(k,v){
                html += "<option value='" +v['goods_class_id']+ "'>" + v['name'] + "</option>";
            });
            $('#sonclass').html(html);
        },"json")
    }
    var html = "<option value='0'>------请选择分类------</option>"; 
    $('#sonclass').html(html);
})
$(".c_save").click(function(){
  if(CheckDataValid("#fbg")){
      var pid=$("#pid option:selected").val();
      var sonclass=$("#sonclass option:selected").val();
      var content1 = cont1.getContent();
      var url = "<{:U('Merchant/sellupd')}>";
      var fbg = new FormData($('#fbg')[0]);
      if(pid == 0){
        layer.msg('请选择分类',{offset: '300px',time: 1500,icon: 7});
        return false;
      }
      if(sonclass == 0){
        layer.msg('请选择二级分类',{offset: '300px',time: 1500,icon: 7});
        return false;
      }
      if(content1 == ""){
          layer.msg('请填写商品详情',{offset: '300px',time: 1500,icon: 7});
          return false;
      }
      $.ajax({
          type : 'post',
          url : url,
          data : fbg,
          async : false,
          processData:false,
          contentType:false,
          error : function () {
              layer.msg('网络故障，请稍后重试!',{offset: '300px',time: 1500,icon: 7});
          },
          success : function (responses) {
              if (responses == 'ok'){
                  layer.msg('修改成功',{offset: '300px',time: 1500,icon: 1},function () {
                     window.location.href = "<{:U('Merchant/auction_list')}>";
                  });
              }else{
                  layer.msg(responses,{offset: '300px',time: 2000,icon: 2});
              }
          }
      });
  }
})
</script>
</body>
</html>
