<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="" />
<meta name="author" content="网页作者的资料"/>
<meta name="keywords" content="<?php echo $_SESSION['sc']['infor']['keywords']?>"></meta>
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>"></meta>
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" /> 
<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE"/> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="renderer" content="webkit"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/min.css/new/css/header_footer.min.css"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/min.css/new/css/member.min.css"/>
<title>商家中心--基本设置--方大商城</title>
<style type="text/css">
    .c_address_in{
    height:528px;
    }
    .c_address{
    padding-left:14px;
    }
    .c_form_con{
    width:785px;
    }
    .c_form_con label{
    width:115px;
    }
    select{
       background: transparent;
       appearance:none;
        -moz-appearance:none;
        -webkit-appearance:none;
       width: 180.5px;
       height: 34px;
       -webkit-appearance: none;
       margin-left: -10px;
       margin-top: 2px;
       border-width:0px;
       line-height: 34px;
       font-size:14px;
       padding-right: 40px;
    }
    .select_showbox{
       overflow: hidden;
    }
    select::-ms-expand { display: block; }

    .c_out_a i, .c_first_out_a i {
        background: rgba(0, 0, 0, 0) url("/Public/Home/static/new/img/icon/member_comm/left_icon.png") no-repeat scroll 0 0;
    }

    .aa div{
        margin-top: 14px;
    }
    .aa div p{
        position: relative;

    }
    .c_form_con .aa div input.uploading{
      opacity: 0;
      width: 148px;
      height: 34px;
      position: absolute;
      top: 0;
      left: 0;
    }
    .aa div:first-child>span {
        position: relative;
        display: block;
    }
    .aa div:first-child span img{
        display: block;
        border: 1px solid #ccc;
    }
    .aa div:first-child span i{
        position: absolute;
        width: 20px;
        height: 20px;
        left: 155px;
        top: -10px;
        border-radius: 50%;
        line-height: 20px;
        text-align: center; 
        font-size: 14px;
        border: 1px solid #000; 
    }
    .aa div:first-child span img{
        width:160px;
        height: 160px;
    }
    .aa div:last-child span {
        position: relative;
        float: left;
        margin-right: 10px;
    }
    .aa div:last-child span img{
        border: 1px solid #ccc;
    }
    .aa div:last-child span i{
        position: absolute;
        width: 20px;
        height: 20px;
        right: -10px;
        top: -10px;
        border-radius: 50%;
        line-height: 20px;
        text-align: center; 
        font-size: 14px;
        border: 1px solid #000; 
    }
    .aa div:last-child span img{
        width:80px;
        height: 80px;
    }
</style>
</head>
<body>
  <!-- S 头部 -->
  <!-- 引入头部 -->
    <include file="public:mhead" />
    <!-- 引入头部 -->
  <!-- E 头部 -->
  <!-- S 内容区域 -->
  <div class="b_sup_content">
      <!-- S 会员资料 -->
      <!--S 头部 -->
      <!-- E 会员资料 -->
      <div id="content_box" class="">
        <!-- S 左侧 -->
        <include file="public:mleft" />
        <!-- E 左侧 -->
        <!-- S 右侧 -->
        <div id="member_right" class="member_right">
        <ul class="b_record_title">
            <li class="b_record_this"><a href="<{:U('Merchant/infor')}>">基本信息</a></li>
            <li><a href="<{:U('Merchant/save')}>">安全中心</a></li>
        </ul>
        <!-- 数据列表栏 -->
        <div class="c_address" id="datalist">
        <form id="fbg">
        <div class="c_address">
                <div class="c_form_con">
                    <label>经营地址：</label>
                    <ul class="c_form_right">
                        <li class="c_contact">
                            <div class="select_showbox">
                              <select style="display: block;" name="pro" id="province">
                                <option value="0">------请选择省------</option>
                                <volist name="province_arr" id="list">
                                  <option value="<{$list.id}>" ><{$list.name}></option>
                                </volist>
                              </select>
                            </div>
                        </li>
                        <li class="c_contact">
                            <div class="select_showbox" id="cityDiv">
                              <select style="display: block;" name="citys" id="city" >
                                <option value="0">------请选择市------</option>
                              </select>
                            </div>
                        </li>
                        <li class="c_contact">
                            <div class="select_showbox" id="areaDiv">
                              <select style="display: block;" name="areas" id="area">
                                <option value="0">------请选择区/县------</option>
                              </select>
                            </div>
                        </li>
                    </ul>
                    <label></label>
                    <div class="c_form_right">
                        <span>
                          <?php
                            $province=M("province");
                            $pro_arr=$province->field("name")->where(['id'=>$res['pro_id']])->find();
                            $city_arr=$province->field("name")->where(['id'=>$res['city_id']])->find();
                            $area_arr=$province->field("name")->where(['id'=>$res['area_id']])->find();
                            echo $pro_arr['name'] . '--' . $city_arr['name'] . '--' . $area_arr['name'];
                          ?>
                        </span>
                    </div>
                    <div class="c_clear"></div>
                </div>

                <div class="c_form_con c_newform_con">
                    <label>店铺名称：</label>
                    <div class="c_form_right">
                        <input class="c_details_address" type="text" name='name' placeholder="店铺名称"  maxlength="10" value="<{$res['store_name']}>"/>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con c_newform_con">
                    <label>店铺简介：</label>
                    <div class="c_form_right">
                        <input class="c_details_address" type="text" name='intro' placeholder="店铺简介"  maxlength="30" value="<{$res['store_intro']}>"/>
                    </div>
                    <div class="c_clear"></div>
                </div>
                <div class="c_form_con" style="height:356px;">
                    <label>店铺介绍：</label>
                      <div class="c_form_right">
                        <script id="editor" name="cont" type="text/plain" style="height:300px;"><{$res['store_cont']}></script>
                      </div>
                </div>
                <div >
                  <button class="c_save" style="display: block;" type="button">提交</button>
                </div>
          </div>
        </div>
      </form>
    </div>
    </div>
  </div>
  <!-- S 底部 -->
<include file="public:pfoot" />
<script src="__PUBLIC__/Admin/javascripts/jquery.min.js"></script>
<script src="__PUBLIC__/Admin/javascripts/layer/layer.js"></script>
<script src="__PUBLIC__/Admin/javascripts/JValidator.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/ueditor.all.min.js"> </script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript">
//实例化编辑器
//建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
var cont1=UE.getEditor('editor',{toolbars: [
    ['fullscreen', 'source', 'undo', 'fontfamily','fontsize','redo', 'bold','italic', 'underline','formatmatch','selectall', 'pasteplain','time','date','simpleupload', 'insertimage','forecolor','justifyleft','justifyright','justifycenter','justifyjustify',]
]});
</script>
<script>
  //下面用于多图片上传预览功能
    // function setImagePreviews1(avalue1) {
    //   var docObj1 = document.getElementById("doc1");
    //   var dd1 = document.getElementById("dd1");
    //   dd1.innerHTML = "";
    //   var fileList = docObj1.files;
    //   for (var i = 0; i < fileList.length; i++) {           
    //     dd1.innerHTML += "<div style='float:left' > <img id='img" + i + "'  /> </div>";
    //     var imgObjPreview = document.getElementById("img"+i); 
    //     if (docObj1.files && docObj1.files[i]) {
    //       //火狐下，直接设img属性
    //       imgObjPreview.style.display = 'block';
    //       imgObjPreview.style.width = '150px';
    //       imgObjPreview.style.height = '180px';
    //       //imgObjPreview.src = docObj1.files[0].getAsDataURL();
    //       //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式
    //       imgObjPreview.src = window.URL.createObjectURL(docObj1.files[i]);
    //     }
    //     else {
    //       //IE下，使用滤镜
    //       docObj1.select();
    //       var imgSrc = document.selection.createRange().text;
    //       alert(imgSrc)
    //       var localImagId = document.getElementById("img" + i);
    //       //必须设置初始大小
    //       localImagId.style.width = "150px";
    //       localImagId.style.height = "180px";
    //       //图片异常的捕捉，防止用户修改后缀来伪造图片
    //       try {
    //           localImagId.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
    //           localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
    //       }
    //       catch (e) {
    //           alert("您上传的图片格式不正确，请重新选择!");
    //           return false;
    //       }
    //       imgObjPreview.style.display = 'none';
    //       document.selection.empty();
    //     }
    //   }  
    //   return true;
    // }
</script>
<script>
/*
 * 方法描述：编辑按钮点击事件
 * 参数：地址在已获取的地址列表中的序号
 */
$("#province").change(function(){
    var url = "<{:U('Merchant/pro_city')}>";
    var procode=$(this).val();
    if(procode==0){
          var html = "<option value='0'>------请选择市------</option>"; 
          var html1 = "<option value='0'>------请选择区/县------</option>";         
          $('#city').html(html);
          $('#area').html(html1);
    }else{
        $.post(url,{procode:procode},function(data){
            /* alert(data); */
            $('#city').empty();
             var html = "<option value='0'>------请选择市------</option>";
            $.each(data, function(k,v){
                html += "<option value='" +v['id']+ "'>" + v['name'] + "</option>";
            });
            $('#city').html(html);
        },"json")
    }
    var html = "<option value='0'>------请选择市------</option>"; 
    var html1 = "<option value='0'>------请选择区/县------</option>";         
    $('#city').html(html);
    $('#area').html(html1);
})
$("#city").change(function(){
    var citycode=$(this).val();
    var url = "<{:U('Merchant/city_area')}>";
    if(citycode==0){
         var html = "<option value='0'>------请选择区/县------</option>"; 
           $('#city').html(html);
    }else{
        $.post(url,{citycode:citycode},function(data){
                /* alert(data); */
            $('#area').empty();
                var html = "<option value='0'>------请选择区/县------</option>";
           $.each(data, function(k,v){
               html += "<option value='" +v['id']+ "'>" + v['name'] + "</option>";
           });
           $('#area').html(html);
        },"json")
    }
          var html1 = "<option value='0'>------请选择区/县------</option>";         
          $('#area').html(html1);
})
$(".c_save").click(function(){
  var name=$("input[name=name]").val();
  var intro=$("input[name=intro]").val();
  var pro=$("#province option:selected").val();
  var city=$("#city option:selected").val();
  var area=$("#area option:selected").val();
  var content1 = cont1.getContent();
  if(name == ''){
     layer.msg('请填写店铺名称',{offset: '300px',time: 1500,icon: 7});
     return false;
  }
  if(intro == ''){
     layer.msg('请填写店铺简介',{offset: '300px',time: 1500,icon: 7});
     return false;
  }
  if(pro == 0){
     layer.msg('请选择省',{offset: '300px',time: 1500,icon: 7});
     return false;
  }
  if(city == 0){
      layer.msg('请选择市',{offset: '300px',time: 1500,icon: 7});
     return false;
  }
  if(area == 0){
      layer.msg('请选择区/县',{offset: '300px',time: 1500,icon: 7});
     return false;
  }
  if(content1 == ""){
      layer.msg('请填写店铺介绍',{offset: '300px',time: 1500,icon: 7});
      return false;
  }
  var url = "<{:U('Merchant/setInfo')}>";
  var fbg = new FormData($('#fbg')[0]);
  $.ajax({
    type : 'post',
    url : url,
    data : fbg,
    async : false,
    processData:false,
    contentType:false,
    error : function () {
        layer.msg('网络故障，请稍后重试!',{offset: '300px',time: 1500,icon: 7});
    },
    success : function (responses) {
        if (responses == 'ok'){
            layer.msg('设置成功',{offset: '300px',time: 1500,icon: 1},function () {
               window.location.reload();
            });
        }else{
            layer.msg(responses,{offset: '300px',time: 1500,icon: 2});
        }
    }
  });
})
</script>
</body>
</html>
