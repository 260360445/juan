<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="" />
<meta name="keywords"content="<?php echo $_SESSION['sc']['infor']['keywords']?>"/>
<meta name="description" content="<?php echo $_SESSION['sc']['infor']['description']?>"/>
<link rel="shortcut icon" href="/<?php echo $_SESSION['sc']['infor']['ico']?>" type="image/x-icon" />  
<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE"/> 
<meta name="renderer" content="webkit"/>
<meta http-equiv="Content－Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<meta name="format-detection" content="telephone=no,address=no,email=no"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/userCenter/css/login1.css"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/userCenter/css/register2.css"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/userCenter/css/forgetPwd2.css"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/userCenter/css/forgetPwd.css"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/userCenter/css/registerNew.css"/>
<link rel="stylesheet" href="__PUBLIC__/Home/static/userCenter/css/login.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/comm.min.css"></link>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/footer_header.min.css"></link>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/index.min.css"></link>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/new_join.min.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/static/min.css/css/front/login_box/login_box.min.css">
<script type="text/javascript" src="__PUBLIC__/Home/static/js/jquery-1.11.3.js"></script>
<title>万花筒-忘记密码</title>
<style>
.yg_for_box{width: 490px;background:#ffffff;font-family:"Microsoft YaHei";}
.yg_for_box form{width: 348px;margin: 0 auto;overflow: hidden;     box-shadow: 0px 3px 9px 0px rgba(9, 2, 4, 0.3); padding: 30px 80px;border-radius: 10px;margin-top: 30px;}
.yg_for_box form label{height: 42px;position: relative;margin-bottom: 28px;display: block;}
.yg_for_box form label p{position: absolute;top: 42px;width: 332px;height: 24px;font-size: 14px;padding-left: 14px;border: 1px solid #c2c2c2;border-top: 0px;color: #616161;}
.yg_for_box form label p.error_yg_p{border: 1px solid #fa9494;border-top: 0px;background: #fcd1d1;color: #f05050;}
.yg_for_box form label p.true_yg_p{border: 1px solid #84c576;border-top: 0px;background: #eff9ff;color: #7abd54;}
.yg_for_box form input{color: #a9a9a9;font-size: 14px;padding-left:100px;border: 1px solid #ccc;outline: none;width: 100%;height: 40px;font-family:"Microsoft YaHei";box-sizing: border-box;}
.yg_for_box h2{color: #111111;font-size: 16px;height: 38px;font-weight: normal;line-height: 38px;padding-left: 13px;position: relative;}
.get_ygqq1 span{float: left;color: #ffffff;font-size: 14px;line-height: 40px;height: 40px;width: 148px;padding-left: 8px;text-align: center;background: #85c576;border: 1px solid #5cba6e;cursor: pointer;position: relative;}
.get_ygqq1 span:hover{background: #90d22c;}
.get_ygqq1 span i{display: block;border-left: 6px solid #fff;border-top: 3px solid transparent;border-bottom: 3px solid transparent;position: absolute;left: 4px;top: 17px;}
.yg_for_box form .get_ygqq1 input{width: 130px;float: left;margin-left: 46px;}
.yg_for_box form a.yg_true{display: block;width: 100%;height: 42px;background: #ff3640;line-height: 42px;text-align: center;color: #fff;border-radius: 2px;font-size: 16px;margin:29px auto 14px;}
/*.yg_for_box form .get_ygqq2 input{width: 102px;float: left;}*/
.get_ygqq2 span{float: left;position: relative;display: block;width: 117px;height: 40px;border: 1px solid #dd2726;margin-left: 9px;}
.get_ygqq2 span img{width: 72px;height: 40px;}
.get_ygqq2 span i{display:block;width: 45px;height: 42px;position: absolute;right: -2px;top: -1px;}
.get_ygqq2 .get_ygqq2_a{position: absolute;right: 0;top: 0;background: #ccc;width: 70px; font-size: 12px; height: 30px;text-align: center;color: #666;line-height: 30px;margin: 5px;}
.y_forget_list{height: 51px;overflow: hidden;}
.email_yg_res{display: none;}
.y_forget_list li{border-top: 2px solid #dddddd;height: 48px;border-bottom: 1px solid #dddddd;float: left;width: 452px;text-align: center;line-height: 48px;color: #555555;font-size: 18px;cursor: pointer;}
.y_forget_list li.for_cl_li{color: #dd2726;border-top: 2px solid #dd2726;border-bottom: 0px;}
.yg_for_boxss{display: none;}
.pass_y_find{display: none;}
.c_error2 {
	width: 100%;
	background: #fffurl("/Public/Home/images/error_icon.png") no-repeat scroll 0 center;
	border: medium none;
	color: #dd2726;
	display: none;
	font-size: 12px;
	height: 38px;
	left: 10px;
	line-height: 43px;
	min-width: 100px;
	padding-left: 20px;
	position: absolute;
	top: 0px;
	left: 200px;
}
.c_add_ygqq{
position: absolute;
top:264px;
right:434px;
display: block;
width:130px;
height:170px;
cursor: pointer;
margin-right:-452px;
}
.y_title_logo {
width: 142px;
}
.header{
    overflow: hidden;
    background-color: #fff;
    border-bottom: 1px solid #e5e5e5;
    padding: 10px 0;
  }
  .header div{
    width: 1200px;
    margin: 0 auto;
  }
  .header a{
    float: left;
  }
  .header p{
    float: left;
    font-size: 20px;
    color: #b3b3b3;
    padding-left: 15px;
    line-height: 40px;
    border-left: 1px solid #e5e5e5;
  }
</style>
</head>
<body>
	<div class="header">
    <div>
        <a href="/"><img src="/<?php echo $_SESSION['sc']['infor']['logo']?>" title="万花筒" alt=""/></a>
        <p>欢迎注册</p>
    </div>
  </div>
<!-- 内容区域 -->
<div class="c_forget_bj">
<div class="c_forget_pwd" style="width:452px;">
	<!-- <a href="/" class="y_title_logo"><img src="__PUBLIC__/Home/static/img/front/index/logo.png"  style="width:160px;height:40px;"></a> -->
	<div class="" style="padding:0px;">
		<!-- <h2 class="login_title" style="text-align:center;padding:30px 0px;font-weight:normal;">重置密码</h2> -->
<!-- 		<ul class="y_forget_list">
			<li class="for_cl_li">使用手机修改</li>
		</ul> -->
		<div class="phone_yg_res yg_for_box yg_for_boxs">
			<form>
			<h4 style="overflow: hidden; position: relative;width: 120%;left: -10% ;margin-bottom: 20px;">
				
				 <p style="float: left;"><img style="float: left;margin-top: -8px;  margin-right: 10px;padding: 10px 0;" src="__PUBLIC__/Home/static/zt/buymember/images/suo.png" alt="" /> 忘记密码</p>
         		 <a href="<{:U('Login/login')}>" style="position:absolute;right: 1px;color: #5d74f0;font-size: 14px;">返回</a>
			</h4>
				<label>
					<h4 style="position: absolute;left: 0;top: 0;line-height: 20px;color: #333; margin: 10px 0; padding: 0 20px;font-size: 12px;border-right: 1px solid #ccc;width: 50px;">手机号</h4>
					<input type="text" id="mobile" maxlength="11" value="请输入手机号"/>
					<!-- 提示信息 -->
					<!-- 正确 -->
					<p class="true_yg_p  mobileRight" style="display: none;">此手机号可用</p>
					<!-- 错误 -->
					<p class="error_yg_p mobileError" style="display: none;">手机号格式输入错误</p>
				</label>
				<label class="get_ygqq2">
					<h4 style="position: absolute;left: 0;top: 0;line-height: 20px;color: #333; margin: 10px 0; padding: 0 20px;font-size: 12px;border-right: 1px solid #ccc;width: 50px;">短信验证</h4>
					<input type="text" id="validCode" style="ime-mode:disabled " value="输入手机验证码" maxlength="4"/>
					<a href="javascript:checkValidCode();" class="get_ygqq2_a">发送验证码</a>
					<p class="error_yg_p code_error2" style="display: none;">验证码输入错误,无法发送</p>
				</label>
				<label>
					<h4 style="position: absolute;left: 0;top: 0;line-height: 20px;color: #333; margin: 10px 0; padding: 0 20px;font-size: 12px;border-right: 1px solid #ccc;width: 50px;">新密码</h4>
					<input type="text" value="请设置您的登录密码" maxlength="20" class="pass_y_find1"/>
					<input type="password" id="password" class="pass_y_find"/>
					<span class="c_error2" id="passwordP">密码不能为空</span>
				</label>
				<label>
					<h4 style="position: absolute;left: 0;top: 0;line-height: 20px;color: #333; margin: 10px 0; padding: 0 20px;font-size: 12px;border-right: 1px solid #ccc;width: 50px;">确认密码</h4>
					<input type="text" value="再次输入登录密码" maxlength="20" class="pass_y_find1"/>
					<input type="password" id="repassword" class="pass_y_find"/>
					<span class="c_error2" id="repasswordP">密码不能为空</span>
				</label>
				<p id="setPassMsg" style="display: none;color:#dd2726;font-size:14px;line-height:30px;padding-left:40px;">
				密码修改成功后，<span id="loginTime">3</span>秒之后跳到登录页面</p>
				<div style="position:relative;">
				<a href="javascript:setPass();" class="yg_true">确认修改</a>
				
				</div>
			</form>
		</div>
	</div>
</div>
</div>
 <include file="public:ppfoot" />
</body>
<script src="__PUBLIC__/Home/static/new/plugin/layer/layer.js"></script>
<script src="__PUBLIC__/Home/static/userCenter/js/forgetPwd1.js"></script>
<script type="text/javascript">
var hei=window.innerHeight;
// $('.c_forget_bj').css('height',hei+'px');
$('body').css('background-size','100% '+hei+'px'+'');

//校验手机号存在	
function checkMobileExist(){
	var url = "<{:U('Register/checkMobileExist')}>";
	var flag = false;
	$.ajax({
		type: "post",
		url: url,
		dataType:'json',
		async: false,
		data:{mobile :$("#mobile").val()},
		success:function(data){
			if(data == 0){
				$(".mobileError").html("该手机号还没有注册！")
				$(".mobileError").show(100).delay(2000).hide(0);
				$("#mobile").focus();
				return flag;
			}else if(data == 1){
				$('#mobile').attr("disabled","disabled")
				flag = true;
				return flag;
			}
		}
	});
	return flag;	
}
//验证码
function checkValidCode(){
	var mobile=$("#mobile").val();
	var isMobile=/^0?1[3-8][0-9]\d{8}$/; //手机号码验证规则
	if(mobile =="请输入手机号" || mobile == "" || mobile == null){
		$('.mobileError').html("请填写手机号");
		$('.mobileError').show(100).delay(2000).hide(0);
		$('.true_yg_p').hide();
		$("#mobile").focus();
		return;
	}else if(!isMobile.test(mobile)){
		$("#mobile").focus();
		$('.mobileError').html("请正确填写手机号");
		$('.mobileError').show(100).delay(2000).hide(0);
		$('.true_yg_p').hide();
		return;
	}else if(checkMobileExist()){
		var url = "<{:U('Register/checkValidCodeUSer')}>";
		$.ajax({
			type: "post",
			url: url,
			dataType:'json',
			async: false,
			data:{
				mobile :$("#mobile").val()
			},
			success:function(data){
				if(data.infor == 2){
					canNext = true;
					var code=$(".get_ygqq2_a");
					time=120;
					$('.get_ygqq2_a').attr('href', '#'); 
					
					t=setInterval(function() {
						time--;
						code.html(time+'秒');
						if (time==0) {
							clearInterval(t);
							canNext = false;
							code.html('确定发送');
							$('.get_ygqq2_a').attr('href', 'javascript:checkValidCode();');
						}
					},1000);
				}else if(data.infor == 3){
					layer.tips('短信验证码发送失败，请重新发送！', '.get_ygqq2_a');
					return false;
				}else if(data.infor == 4){
					layer.tips('手机号不存在，请重新填写！', '.get_ygqq2_a');
					return false;
				}
			}
		});
	}
}
function setPass(){
	var password=$("#password").val();
	var repassword=$("#repassword").val();
	var url = "<{:U('Register/setPass')}>";
	if(password==null || password == ""){
		$("#passwordP").parent("label").find(".pass_y_find").show();
		$("#passwordP").parent("label").find(".pass_y_find1").hide();
		$("#passwordP").show();
	}else if(!/(?!^(\d+|[a-zA-Z]+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]{8,20}$/.test(password)){
		$("#passwordP").html("长度为8-20位字母+数字的组合!");
		$("#passwordP").show();
	}else if(repassword==null || repassword == ""){
		$("#repasswordP").parent("label").find(".pass_y_find").show();
		$("#repasswordP").parent("label").find(".pass_y_find1").hide();
		$("#repasswordP").show();
	}else if(repassword!=password){
		$("#repasswordP").html("两次输入的密码不同！");
		$("#repasswordP").show();
	}else{
		$.ajax({
			type: "post",
			url: url,
			//dataType:'json',
			data:{
				mobile:$('#mobile').val(),
				pass:$('#password').val(),
				code:$("#validCode").val()
			},
			success:function(data){
				if(data == 2){
					$('#setPassMsg').show();
					var loginTime=3;
					$("#loginTime").html(loginTime);
					t2=setInterval(function() {
						loginTime--;
						$("#loginTime").html(loginTime);
						if (loginTime==0) {
							clearInterval(t2);
							window.location.href="<{:U('Pcenter/account')}>";
						}
					},1000);
				}else if(data == 4){
					layer.msg('手机号不存在',{offset: '300px',time: 1500,icon: 2});
        			return false;
				}else if(data == 3){
					layer.msg('修改失败，请稍后再试',{offset: '300px',time: 1500,icon: 2});
        			return false;
				}
			}
		});
	}
}
</script>
</html>
